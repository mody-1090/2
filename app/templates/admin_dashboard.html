{% extends "base.html" %}

{% block title %}ููุญุฉ ุชุญูู ุงููุดุฑู{% endblock %}

{% block content %}
<div class="container-fluid p-4">

  <!-- ุนููุงู ููุญุฉ ุงูุชุญูู -->
  <div class="row mb-4">
    <div class="col text-center">
      <h2 class="display-4">
        <i class="bi bi-speedometer2"></i> ููุญุฉ ุงูุชุญูู - ุงููุดุฑู
      </h2>
    </div>
  </div>

  <!-- ูุงุฆูุฉ ุงูุชููู ููุฃูุณุงู -->
  <ul class="nav nav-tabs mb-4" id="dashboardTabs">
    <li class="nav-item">
      <a class="nav-link active" href="#" data-target="statisticsSection">ุฅุญุตุงุฆูุงุช ุนุงูุฉ</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#" data-target="ordersSection">ุฅุฏุงุฑุฉ ุงูุทูุจุงุช (ุนุฑุถ)</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#" data-target="editOrdersSection">ุฅุฏุงุฑุฉ ุงูุทูุจุงุช (ุชุญุฑูุฑ)</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#" data-target="newOrderSection">ุฅูุดุงุก ุทูุจูุฉ ุฌุฏูุฏุฉ</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#" data-target="pendingReviewSection">ุงูุทูุจุงุช ุงููุนููุฉ ูููุฑุงุฌุนุฉ</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#" data-target="approvedSection">ุงูุทูุจุงุช ุงูููุจููุฉ</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#" data-target="rejectedSection">ุงูุทูุจุงุช ุงููุฑููุถุฉ</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#" data-target="factoryAgreementSection">ุฅูุดุงุก ุงุชูุงู ุงููุตูุน</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#" data-target="factoryAgreementsSection">ุงูุงุชูุงูุงุช ุงููุจุฑูุฉ</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#" data-target="withdrawalsSection">ุฅุฏุงุฑุฉ ุทูุจุงุช ุณุญุจ ุงูุฃุฑุจุงุญ</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#" data-target="intermediariesSection">ุงููุณุทุงุก ุงููุณุฌููู</a>
    </li>
  </ul>

  <!-- ุงูุฃูุณุงู -->

  <!-- 1. ุฅุญุตุงุฆูุงุช ุนุงูุฉ -->
  <div id="statisticsSection" class="dashboard-section">
    <div class="row mb-4">
      <div class="col-12">
        <div class="card shadow mb-4">
          <div class="card-header bg-info text-white">
            <h4 class="mb-0">
              <i class="bi bi-bar-chart"></i> ุฅุญุตุงุฆูุงุช ุนุงูุฉ
            </h4>
          </div>
          <div class="card-body">
            <div class="row text-center">
              <div class="col-md-3 mb-3">
                <div class="card border-info h-100">
                  <div class="card-body">
                    <h5 class="card-title">ุนุฏุฏ ุงูุทูุจุงุช</h5>
                    <p class="card-text display-6">{{ orders | length }}</p>
                  </div>
                </div>
              </div>
              <div class="col-md-3 mb-3">
                <div class="card border-info h-100">
                  <div class="card-body">
                    <h5 class="card-title">ุนุฏุฏ ุงููุณุทุงุก</h5>
                    <p class="card-text display-6">{{ intermediaries | length }}</p>
                  </div>
                </div>
              </div>
              <div class="col-md-3 mb-3">
                <div class="card border-success h-100">
                  <div class="card-body">
                    <h5 class="card-title">ุทูุจุงุช ููุชููุฉ</h5>
                    <p class="card-text display-6">{{ completed_orders }}</p>
                  </div>
                </div>
              </div>
              <div class="col-md-3 mb-3">
                <div class="card border-warning h-100">
                  <div class="card-body">
                    <h5 class="card-title">ุทูุจุงุช ููุชูุญุฉ</h5>
                    <p class="card-text display-6">{{ open_orders }}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

<!-- ๐จ ูุณู ุฑุณุงุฆู "ุชูุงุตู ูุนูุง" -->
<h3>๐จ ุงูุฑุณุงุฆู ุงููุงุฑุฏุฉ</h3>
<div class="card shadow mb-4">
  <div class="card-header bg-primary text-white">
    <h4 class="mb-0"><i class="bi bi-envelope"></i> ุงูุฑุณุงุฆู ุงููุงุฑุฏุฉ</h4>
  </div>
  <div class="card-body">
    {% if messages %}
      <div class="list-group">
        {% for message in messages %}
          <div class="list-group-item list-group-item-action flex-column align-items-start">
            <div class="d-flex w-100 justify-content-between">
              <h5 class="mb-1"><i class="bi bi-person"></i> {{ message.name }}</h5>
              <small class="text-muted">{{ message.created_at.strftime('%Y-%m-%d %H:%M') }}</small>
            </div>
            <p class="mb-1"><i class="bi bi-envelope-at"></i> <strong>{{ message.email }}</strong></p>
            <p class="text-dark"><i class="bi bi-chat-dots"></i> {{ message.content }}</p>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="alert alert-info text-center">
        ๐ ูุง ุชูุฌุฏ ุฑุณุงุฆู ุฌุฏูุฏุฉ.
      </div>
    {% endif %}
  </div>
</div>
  </div>

  <!-- 2. ุฅุฏุงุฑุฉ ุงูุทูุจุงุช (ุนุฑุถ) -->
  <div id="ordersSection" class="dashboard-section" style="display:none;">
    <div class="row mb-4">
      <div class="col-12">
        <div class="card shadow mb-4">
          <div class="card-header bg-secondary text-white">
            <h4 class="mb-0">
              <i class="bi bi-folder"></i> ุฅุฏุงุฑุฉ ุงูุทูุจุงุช
            </h4>
          </div>
          <div class="card-body">
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>ุฑูู ุงูุทูุจ</th>
                  <th>ุงุณู ุงูุทูุจ</th>
                  <th>ุงููููุฉ ุงููุทููุจุฉ</th>
                  <th>ุงููููุฉ ุงูููุชููุฉ</th>
                  <th>ุญุงูุฉ ุงูุทูุจ</th>
                  <th>ุงูุฅุฌุฑุงุกุงุช</th>
                </tr>
              </thead>
              <tbody>
                {% for order in orders[:12] %}
                <tr>
                  <td>{{ order.id }}</td>
                  <td>{{ order.name }}</td>
                  <td>{{ order.quantity_needed }}</td>
                  <td>{{ order.quantity_covered }}</td>
                  <td>
                    {% if order.quantity_covered >= order.quantity_needed %}
                      <span class="badge bg-success">ููุชููุฉ</span>
                    {% else %}
                      <span class="badge bg-warning text-dark">ููุชูุญุฉ</span>
                    {% endif %}
                  </td>
                  <td>
                    <form method="POST" action="{{ url_for('main_routes.delete_order', order_id=order.id) }}" onsubmit="return confirm('ูู ุฃูุช ูุชุฃูุฏ ุฃูู ุชุฑูุฏ ุญุฐู ูุฐู ุงูุทูุจูุฉุ')">
                      <button type="submit" class="btn btn-danger btn-sm rounded-pill shadow-sm">
                        <i class="bi bi-trash"></i> ุญุฐู
                      </button>
                    </form>
                  </td>
                </tr>
                {% else %}
                <tr>
                  <td colspan="6" class="text-center">ูุง ุชูุฌุฏ ุทูุจุงุช.</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
            {% if orders|length > 12 %}
            <div class="d-flex justify-content-center mt-3">
              <a href="{{ url_for('dashboard_orders_page', page=2) }}" class="btn btn-outline-primary rounded-pill shadow-sm">ุงูุชุงูู</a>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 3. ุฅุฏุงุฑุฉ ุงูุทูุจุงุช (ุชุญุฑูุฑ) -->
  <div id="editOrdersSection" class="dashboard-section" style="display:none;">
    <div class="row mb-4">
      <div class="col-12">
        <div class="card shadow mb-4">
          <div class="card-header bg-secondary text-white">
            <h4 class="mb-0">
              <i class="bi bi-folder"></i> ุฅุฏุงุฑุฉ ุงูุทูุจุงุช
            </h4>
          </div>
          <div class="card-body">
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>ุฑูู ุงูุทูุจ</th>
                  <th>ุงุณู ุงูุทูุจูุฉ</th>
                  <th>ูุตู ุงูุทูุจูุฉ</th>
                  <th>ุงููููุฉ ุงููุทููุจุฉ</th>
                  <th>ุงูุณุนุฑ ููู ูุฑุชููุฉ</th>
                  <th>ุงูุญุฏ ุงูุฃุฏูู ูููุดุงุฑูุฉ</th>
                  <th>ุงูุฑุจุญ ููู ูุฑุชููุฉ</th>
                  <th>ุงููุฏู ุงููุชุงุญุฉ</th>
                  <th>ููุนุฏ ุงูุฅุบูุงู</th>
                  <th>ููุนุฏ ุงูุชุณููู</th>
                  <th>ุตูุฑุฉ ุงูููุชุฌ</th>
                  <th>ุงูุฅุฌุฑุงุกุงุช</th>
                </tr>
              </thead>
              <tbody>
                {% for order in orders[:12] %}
                <tr>
                  <form method="POST" action="{{ url_for('main_routes.update_order', order_id=order.id) }}" enctype="multipart/form-data">
                    <td>{{ order.id }}</td>
                    <td><input type="text" name="name" value="{{ order.name }}" class="form-control form-control-sm"></td>
                    <td><textarea name="description" class="form-control form-control-sm">{{ order.description }}</textarea></td>
                    <td><input type="number" name="quantity_needed" value="{{ order.quantity_needed }}" class="form-control form-control-sm"></td>
                    <td><input type="number" name="price_per_carton" value="{{ order.price_per_carton }}" step="0.01" class="form-control form-control-sm"></td>
                    <td><input type="number" name="min_contribution" value="{{ order.min_contribution }}" class="form-control form-control-sm"></td>
                    <td><input type="number" name="earnings_per_carton" value="{{ order.earnings_per_carton }}" step="0.1" class="form-control form-control-sm"></td>
                    <td><input type="text" name="cities_available" value="{{ order.cities_available }}" class="form-control form-control-sm"></td>
                    <td><input type="date" name="closing_date" value="{{ order.closing_date }}" class="form-control form-control-sm"></td>
                    <td><input type="date" name="delivery_date" value="{{ order.delivery_date }}" class="form-control form-control-sm"></td>
                    <td>
                      {% if order.image_url %}
                        <a href="{{ url_for('static', filename=order.image_url.replace('static/', '')) }}" target="_blank">
                          <img src="{{ url_for('static', filename=order.image_url.replace('static/', '')) }}" 
                               alt="ุตูุฑุฉ ุงูููุชุฌ" width="80" height="80" style="object-fit: cover;">
                        </a>
                      {% else %}
                        ูุง ููุฌุฏ ุตูุฑุฉ
                      {% endif %}
                      
                      <!-- ุฎูุงุฑ ุฑูุน ุตูุฑุฉ ุฌุฏูุฏุฉ -->
                      <form method="POST" action="{{ url_for('main_routes.update_order', order_id=order.id) }}" enctype="multipart/form-data" class="mt-2">
                        <input type="file" name="product_image" class="form-control form-control-sm">
                        <button type="submit" class="btn btn-primary btn-sm rounded-pill shadow-sm mt-1">
                          <i class="bi bi-upload"></i> ุชุญุฏูุซ ุงูุตูุฑุฉ
                        </button>
                      </form>
                    </td>
                    <td>
                      <button type="submit" class="btn btn-primary btn-sm rounded-pill shadow-sm">
                        <i class="bi bi-pencil"></i> ุชุญุฑูุฑ
                      </button>
                      <form method="POST" action="{{ url_for('main_routes.delete_order', order_id=order.id) }}" onsubmit="return confirm('ูู ุฃูุช ูุชุฃูุฏ ุฃูู ุชุฑูุฏ ุญุฐู ูุฐู ุงูุทูุจูุฉุ')" style="display:inline;">
                        <button type="submit" class="btn btn-danger btn-sm rounded-pill shadow-sm">
                          <i class="bi bi-trash"></i> ุญุฐู
                        </button>
                      </form>
                    </td>
                  </form>
                </tr>
                {% else %}
                <tr>
                  <td colspan="12" class="text-center">ูุง ุชูุฌุฏ ุทูุจุงุช.</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
            {% if orders|length > 12 %}
            <div class="d-flex justify-content-center mt-3">
              <a href="{{ url_for('dashboard_orders_edit_page', page=2) }}" class="btn btn-outline-primary rounded-pill shadow-sm">ุงูุชุงูู</a>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 4. ุฅูุดุงุก ุทูุจูุฉ ุฌุฏูุฏุฉ -->
  <div id="newOrderSection" class="dashboard-section" style="display:none;">
    <div class="row mb-4">
      <div class="col-12">
        <div class="card shadow mb-4">
          <div class="card-header bg-primary text-white">
            <h4 class="mb-0">
              <i class="bi bi-plus-circle"></i> ุฅูุดุงุก ุทูุจูุฉ ุฌุฏูุฏุฉ
            </h4>
          </div>
          <div class="card-body">
            <form method="POST" action="{{ url_for('main_routes.dashboard') }}" enctype="multipart/form-data">
              <div class="row">
                <!-- ูุนูููุงุช ุงูููุชุฌ -->
                <div class="col-md-6">
                  <h5>
                    <i class="bi bi-bag"></i> ูุนูููุงุช ุงูููุชุฌ
                  </h5>
                  <div class="mb-3">
                    <label for="product_name" class="form-label">ุงุณู ุงูุทูุจูุฉ</label>
                    <input type="text" class="form-control" id="product_name" name="product_name" required>
                  </div>
                  <div class="mb-3">
                    <label for="description" class="form-label">ูุตู ุงูุทูุจูุฉ</label>
                    <textarea class="form-control" id="description" name="description" rows="2" required></textarea>
                  </div>
                  <div class="mb-3">
                    <label for="product_image" class="form-label">๐ท ุตูุฑุฉ ุงูููุชุฌ (ุงุฎุชูุงุฑู)</label>
                    <input type="file" class="form-control" id="product_image" name="product_image">
                  </div>
                </div>
                <!-- ุงููููุงุช ูุงูุชุณุนูุฑ -->
                <div class="col-md-6">
                  <h5>
                    <i class="bi bi-currency-dollar"></i> ุงููููุงุช ูุงูุชุณุนูุฑ
                  </h5>
                  <div class="mb-3">
                    <label for="quantity" class="form-label">ุงููููุฉ ุงููุทููุจุฉ</label>
                    <input type="number" class="form-control" id="quantity" name="quantity" required>
                  </div>
                  <div class="mb-3">
                    <label for="price_per_carton" class="form-label">ุงูุณุนุฑ ููู ูุฑุชููุฉ</label>
                    <input type="number" class="form-control" id="price_per_carton" name="price_per_carton" step="0.01" required>
                  </div>
                  <div class="mb-3">
                    <label for="min_participation" class="form-label">ุงูุญุฏ ุงูุฃุฏูู ูููุดุงุฑูุฉ</label>
                    <input type="number" class="form-control" id="min_participation" name="min_participation" required>
                  </div>
                </div>
              </div>

              <hr>

              <!-- ููุงูุฃุฉ ุงููุณูุท -->
              <div class="mb-3">
                <h5>
                  <i class="bi bi-award"></i> ููุงูุฃุฉ ุงููุณูุท
                </h5>
                <label for="earnings_per_carton" class="form-label">๐ข ุงูุฑุจุญ ููู ูุฑุชููุฉ</label>
                <input type="number" class="form-control" id="earnings_per_carton" name="earnings_per_carton" step="0.1" placeholder="ุฃุฏุฎู ูููุฉ ุงูุฑุจุญ ููู ูุฑุชููุฉ" required>
              </div>

              <hr>

              <!-- ุดุฑูุท ุงูุฏูุน ูุงูุชุณููู -->
              <div class="row">
                <div class="col-md-4">
                  <h5>
                    <i class="bi bi-building"></i> ุงููุฏู ุงููุชุงุญุฉ
                  </h5>
                  <div class="mb-3">
                    <label for="city" class="form-label">๐๏ธ ุงููุฏู ุงููุชุงุญุฉ ููุชุณููู</label>
                    <input type="text" class="form-control" id="city" name="city" required>
                  </div>
                </div>
                <div class="col-md-4">
                  <h5>
                    <i class="bi bi-calendar3"></i> ููุนุฏ ุงูุทูุจูุฉ
                  </h5>
                  <div class="mb-3">
                    <label for="order_deadline" class="form-label">๐ ููุนุฏ ุฅุบูุงู ุงูุทูุจูุฉ</label>
                    <input type="date" class="form-control" id="order_deadline" name="order_deadline" required>
                  </div>
                </div>
                <div class="col-md-4">
                  <h5>
                    <i class="bi bi-truck"></i> ููุนุฏ ุงูุชุณููู
                  </h5>
                  <div class="mb-3">
                    <label for="delivery_date" class="form-label">๐ ููุนุฏ ุงูุชุณููู ุงููุชููุน</label>
                    <input type="date" class="form-control" id="delivery_date" name="delivery_date" required>
                  </div>
                </div>
              </div>
              <div class="text-end">
                <button type="submit" class="btn btn-success rounded-pill shadow-sm">
                  <i class="bi bi-check-circle"></i> ุฅูุดุงุก ุงูุทูุจูุฉ
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

<!-- 5. ุงูุทูุจุงุช ุงููุนููุฉ ูููุฑุงุฌุนุฉ -->
<div id="pendingReviewSection" class="dashboard-section" style="display:none;">
  <div class="row mb-4">
    <div class="col-12">
      <div class="card shadow mb-4">
        <div class="card-header bg-warning text-dark">
          <h4 class="mb-0">
            <i class="bi bi-clock-history"></i> ุงูุทูุจุงุช ุงููุนููุฉ ูููุฑุงุฌุนุฉ
          </h4>
        </div>
        <div class="card-body">
          <table class="table table-bordered table-hover">
            <thead>
              <tr>
                <th>ุงููุชุฌุฑ</th>
                <th>ุงููููุน</th>
                <th>ุงููุณูุท</th>
                <th>ุนุฏุฏ ุงููุฑุงุชูู</th>
                <th>ุงููุจูุบ ุงููุทููุจ</th>
                <th>๐ค ุงุณู ุงููุณุคูู</th>
                <th>๐ฑ ุฑูู ุงูุฌูุงู</th>
                <th>ุฑุงุจุท ุงูุทูุจูุฉ</th>
                <th>ุฑุงุจุท ุชูุงุตูู ุงูุนููู</th>
                <th>๐ ุงูุณุฌู ุงูุชุฌุงุฑู</th>
                <th>๐ช ุตูุฑุฉ ุงููุญู</th>
                <th>ุงูุฅูุตุงู ุงููุงูู</th>
                <th>ุงูุฅุฌุฑุงุกุงุช</th>
              </tr>
            </thead>
            <tbody>
              {% for participant in pending_orders[:12] %}
              <tr>
                <td>{{ participant.store_name }}</td>
                <td>{{ participant.location }}</td>
                <td>{{ participant.intermediary.username }}</td>
                <td>{{ participant.cartons_requested }}</td>
                <td>{{ participant.cartons_requested * participant.order.price_per_carton }} ุฑูุงู</td>
                <td>{{ participant.responsible_person }}</td>
                <td>{{ participant.customer_phone }}</td>
                <td>
                  <a href="{{ url_for('main_routes.order_details', order_id=participant.order.id) }}" target="_blank" class="btn btn-sm btn-info rounded-pill shadow-sm">
                    <i class="bi bi-link"></i> ุนุฑุถ ุงูุทูุจูุฉ
                  </a>
                </td>
                <td>
                  <a href="{{ url_for('main_routes.customer_order_details', participant_id=participant.id) }}" target="_blank" class="btn btn-sm btn-primary rounded-pill shadow-sm">
                    <i class="bi bi-eye"></i> ุนุฑุถ ุชูุงุตูู ุงูุนููู
                  </a>
                </td>
                <td>
                  {% if participant.commercial_record %}
                      <a href="{{ participant.commercial_record }}" target="_blank">
                          <img src="{{ participant.commercial_record }}" alt="ุงูุณุฌู ุงูุชุฌุงุฑู" width="80" height="80" style="object-fit: cover;">
                      </a>
                  {% else %}
                      ูุง ููุฌุฏ
                  {% endif %}
              </td>
              <td>
                  {% if participant.store_sign %}
                      <a href="{{ participant.store_sign }}" target="_blank">
                          <img src="{{ participant.store_sign }}" alt="ุตูุฑุฉ ุงููุญู" width="80" height="80" style="object-fit: cover;">
                      </a>
                  {% else %}
                      ูุง ููุฌุฏ
                  {% endif %}
              </td>
              
                <td>
                  {% if participant.payment_receipt %}
                  <a href="{{ participant.payment_receipt }}" target="_blank">
                      <img src="{{ participant.payment_receipt }}" alt="ุฅูุตุงู ุงูุฏูุน" width="80" height="80" style="object-fit: cover;">
                  </a>
              {% else %}
                  ูุง ููุฌุฏ
              {% endif %}
              
                </td>
                <td>
                  <form method="POST" action="{{ url_for('main_routes.approve_order', participant_id=participant.id) }}" style="display:inline;">
                    <button type="submit" class="btn btn-success btn-sm rounded-pill shadow-sm">
                      <i class="bi bi-check"></i> ูุจูู ุงูุทูุจ
                    </button>
                  </form>
                  <form method="POST" action="{{ url_for('main_routes.reject_order', participant_id=participant.id) }}" style="display:inline;">
                    <button type="submit" class="btn btn-danger btn-sm rounded-pill shadow-sm">
                      <i class="bi bi-x"></i> ุฑูุถ ุงูุทูุจ
                    </button>
                  </form>
                </td>
              </tr>
              {% else %}
              <tr>
                <td colspan="13" class="text-center">ูุง ุชูุฌุฏ ุทูุจุงุช ูุนููุฉ ูููุฑุงุฌุนุฉ.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          {% if pending_orders|length > 12 %}
          <div class="d-flex justify-content-center mt-3">
            <a href="{{ url_for('dashboard_pending_orders_page', page=2) }}" class="btn btn-outline-primary rounded-pill shadow-sm">ุงูุชุงูู</a>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>


  <!-- 6. ุงูุทูุจุงุช ุงูููุจููุฉ -->
  <div id="approvedSection" class="dashboard-section" style="display:none;">
    <div class="row mb-4">
      <div class="col-12">
        <div class="card shadow mb-4">
          <div class="card-header bg-success text-white">
            <h4 class="mb-0">
              <i class="bi bi-check2-circle"></i> ุงูุทูุจุงุช ุงูููุจููุฉ
            </h4>
          </div>
          <div class="card-body">
            <table class="table table-bordered table-hover">
              <thead>
                <tr>
                  <th>ุงููุณูุท</th>
                  <th>ุงููุชุฌุฑ</th>
                  <th>ุนุฏุฏ ุงููุฑุงุชูู</th>
                  <th>ุงููุจูุบ ุงููุฏููุน</th>
                  <th>ุฑุงุจุท ุงูุทูุจูุฉ</th>
                  <th>ุฑุงุจุท ุชูุงุตูู ุงูุนููู</th>
                  <th>ุงูุฅูุตุงู ุงููุงูู</th>
                  <th>ุงูุฅุฌุฑุงุกุงุช</th>
                </tr>
              </thead>
              <tbody>
                {% for participant in approved_orders[:12] %}
                <tr>
                  <td>{{ participant.intermediary.username }}</td>
                  <td>{{ participant.store_name }}</td>
                  <td>{{ participant.cartons_requested }}</td>
                  <td>{{ participant.cartons_requested * participant.order.price_per_carton }} ุฑูุงู</td>
                  <td>
                    <a href="{{ url_for('main_routes.order_details', order_id=participant.order.id) }}" target="_blank" class="btn btn-sm btn-info rounded-pill shadow-sm">
                      <i class="bi bi-link"></i> ุนุฑุถ ุงูุทูุจูุฉ
                    </a>
                  </td>
                  <td>
                    <a href="{{ url_for('main_routes.customer_order_details', participant_id=participant.id) }}" target="_blank" class="btn btn-sm btn-primary rounded-pill shadow-sm">
                      <i class="bi bi-eye"></i> ุนุฑุถ ุชูุงุตูู ุงูุนููู
                    </a>
                  </td>
                  <td>
                    {% if participant.payment_receipt %}
                    <a href="{{ participant.payment_receipt }}" target="_blank">
                        <img src="{{ participant.payment_receipt }}" alt="ุฅูุตุงู ุงูุฏูุน" width="80" height="80" style="object-fit: cover;">
                    </a>
                {% else %}
                    ูุง ููุฌุฏ
                {% endif %}
                
                  </td>
                  <td>
                    <form method="POST" action="{{ url_for('main_routes.revert_order', participant_id=participant.id) }}">
                      <button type="submit" class="btn btn-warning btn-sm rounded-pill shadow-sm">
                        <i class="bi bi-arrow-counterclockwise"></i> ุชุฑุงุฌุน ุนู ุงููุจูู
                      </button>
                    </form>
                  </td>
                </tr>
                {% else %}
                <tr>
                  <td colspan="8" class="text-center">ูุง ุชูุฌุฏ ุทูุจุงุช ููุจููุฉ.</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
            {% if approved_orders|length > 12 %}
            <div class="d-flex justify-content-center mt-3">
              <a href="{{ url_for('dashboard_approved_orders_page', page=2) }}" class="btn btn-outline-primary rounded-pill shadow-sm">ุงูุชุงูู</a>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 7. ุงูุทูุจุงุช ุงููุฑููุถุฉ -->
  <div id="rejectedSection" class="dashboard-section" style="display:none;">
    <div class="row mb-4">
      <div class="col-12">
        <div class="card shadow mb-4">
          <div class="card-header bg-danger text-white">
            <h4 class="mb-0">
              <i class="bi bi-x-circle"></i> ุงูุทูุจุงุช ุงููุฑููุถุฉ
            </h4>
          </div>
          <div class="card-body">
            <table class="table table-bordered table-hover">
              <thead>
                <tr>
                  <th>ุงููุณูุท</th>
                  <th>ุงููุชุฌุฑ</th>
                  <th>ุนุฏุฏ ุงููุฑุงุชูู</th>
                  <th>ุงููุจูุบ ุงูุฐู ูุงู ูุทููุจูุง</th>
                  <th>ุฑุงุจุท ุงูุทูุจูุฉ</th>
                  <th>ุฑุงุจุท ุชูุงุตูู ุงูุนููู</th>
                  <th>ุงูุฅูุตุงู ุงููุงูู</th>
                  <th>ุณุจุจ ุงูุฑูุถ</th>
                </tr>
              </thead>
              <tbody>
                {% for participant in rejected_orders[:12] %}
                <tr>
                  <td>{{ participant.intermediary.username }}</td>
                  <td>{{ participant.store_name }}</td>
                  <td>{{ participant.cartons_requested }}</td>
                  <td>{{ participant.cartons_requested * participant.order.price_per_carton }} ุฑูุงู</td>
                  <td>
                    <a href="{{ url_for('main_routes.order_details', order_id=participant.order.id) }}" target="_blank" class="btn btn-sm btn-info rounded-pill shadow-sm">
                      <i class="bi bi-link"></i> ุนุฑุถ ุงูุทูุจูุฉ
                    </a>
                  </td>
                  <td>
                    <a href="{{ url_for('main_routes.customer_order_details', participant_id=participant.id) }}" target="_blank" class="btn btn-sm btn-primary rounded-pill shadow-sm">
                      <i class="bi bi-eye"></i> ุนุฑุถ ุชูุงุตูู ุงูุนููู
                    </a>
                  </td>
                  <td>
                    {% if participant.payment_receipt %}
                    <a href="{{ participant.payment_receipt }}" target="_blank">
                        <img src="{{ participant.payment_receipt }}" alt="ุฅูุตุงู ุงูุฏูุน" width="80" height="80" style="object-fit: cover;">
                    </a>
                {% else %}
                    ูุง ููุฌุฏ
                {% endif %}
                
                  </td>
                  <td>
                    {% if participant.rejection_reason %}
                      {{ participant.rejection_reason }}
                    {% else %}
                      ูู ูุชู ุชุญุฏูุฏ ุงูุณุจุจ
                    {% endif %}
                  </td>
                </tr>
                {% else %}
                <tr>
                  <td colspan="8" class="text-center">ูุง ุชูุฌุฏ ุทูุจุงุช ูุฑููุถุฉ.</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
            {% if rejected_orders|length > 12 %}
            <div class="d-flex justify-content-center mt-3">
              <a href="{{ url_for('dashboard_rejected_orders_page', page=2) }}" class="btn btn-outline-primary rounded-pill shadow-sm">ุงูุชุงูู</a>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 8. ุฅูุดุงุก ุงุชูุงู ุงููุตูุน -->
  <div id="factoryAgreementSection" class="dashboard-section" style="display:none;">
    <div class="row mb-4">
      <div class="col-12">
        <div class="card shadow mb-4">
          <div class="card-header bg-info text-white">
            <h4 class="mb-0">
              <i class="bi bi-file-earmark-text"></i> ุฅูุดุงุก ุงุชูุงู ุงููุตูุน
            </h4>
          </div>
          <div class="card-body">
            <form method="POST" action="{{ url_for('main_routes.create_factory_agreement') }}">
              <div class="mb-3">
                <label for="order_id" class="form-label">๐ฆ ุงุฎุชูุงุฑ ุงูุทูุจูุฉ</label>
                <select class="form-control" id="order_id" name="order_id" required>
                  <option value="">-- ุงุฎุชุฑ ุทูุจูุฉ --</option>
                  {% for order in orders %}
                    <option value="{{ order.id }}">{{ order.name }}</option>
                  {% endfor %}
                </select>
              </div>
              <div class="mb-3">
                <label for="company_name" class="form-label">๐ญ ุงุณู ุงูุดุฑูุฉ</label>
                <input type="text" class="form-control" id="company_name" name="company_name" required>
              </div>
              <div class="mb-3">
                <label for="commission" class="form-label">๐ฐ ุนูููุฉ ุงูููุตุฉ ููู ูุฑุชูู</label>
                <input type="number" class="form-control" id="commission" name="commission" step="0.01" value="1.5" required>
              </div>
              <button type="submit" class="btn btn-primary rounded-pill shadow-sm">
                <i class="bi bi-link"></i> ุฅูุดุงุก ุงูุงุชูุงู
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 9. ุงูุงุชูุงูุงุช ุงููุจุฑูุฉ ูุน ุงููุตุงูุน -->
  <div id="factoryAgreementsSection" class="dashboard-section" style="display:none;">
    <div class="row mb-4">
      <div class="col-12">
        <div class="card shadow mb-4">
          <div class="card-header bg-warning text-dark">
            <h4 class="mb-0">
              <i class="bi bi-link"></i> ุงูุงุชูุงูุงุช ุงููุจุฑูุฉ ูุน ุงููุตุงูุน
            </h4>
          </div>
          <div class="card-body">
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>ุฑูู ุงูุงุชูุงู</th>
                  <th>๐ฆ ุงูุทูุจูุฉ</th>
                  <th>๐ญ ุงุณู ุงูุดุฑูุฉ</th>
                  <th>๐ ุฑุงุจุท ุงูุงุชูุงู</th>
                  <th>๐ ุญุงูุฉ ุงูุงุชูุงู</th>
                </tr>
              </thead>
              <tbody>
                {% for agreement in factory_agreements[:12] %}
                <tr>
                  <td>{{ agreement.id }}</td>
                  <td>{{ agreement.order.name }}</td>
                  <td>{{ agreement.company_name }}</td>
                  <td>
                    <a href="{{ url_for('main_routes.factory_agreement', agreement_link=agreement.agreement_link.replace('factory_agreement/', '')) }}" target="_blank" class="btn btn-sm btn-info rounded-pill shadow-sm">
                      <i class="bi bi-link-45deg"></i> ูุชุญ ุงูุงุชูุงู
                    </a>
                  </td>
                  <td>
                    {% if agreement.status == "pending" %}
                      <span class="badge bg-warning text-dark">ูู ุงูุชุธุงุฑ ููุงููุฉ ุงููุตูุน</span>
                    {% elif agreement.status == "approved" %}
                      <span class="badge bg-success">ููุนุชูุฏ</span>
                    {% else %}
                      <span class="badge bg-danger">ูุฑููุถ</span>
                    {% endif %}
                  </td>
                </tr>
                {% else %}
                <tr>
                  <td colspan="5" class="text-center">ูุง ุชูุฌุฏ ุงุชูุงูุงุช ูุจุฑูุฉ ุญุชู ุงูุขู.</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
            {% if factory_agreements|length > 12 %}
            <div class="d-flex justify-content-center mt-3">
              <a href="{{ url_for('dashboard_factory_agreements_page', page=2) }}" class="btn btn-outline-primary rounded-pill shadow-sm">ุงูุชุงูู</a>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 10. ุฅุฏุงุฑุฉ ุทูุจุงุช ุณุญุจ ุงูุฃุฑุจุงุญ -->
  <div id="withdrawalsSection" class="dashboard-section" style="display:none;">
    <div class="card shadow mb-4">
      <div class="card-header bg-info text-white">
        <h4 class="mb-0"><i class="bi bi-wallet"></i> ุฅุฏุงุฑุฉ ุทูุจุงุช ุณุญุจ ุงูุฃุฑุจุงุญ</h4>
      </div>
      <div class="card-body table-responsive">

        <!-- ุฃ. ุทูุจุงุช ุงูุณุญุจ ููุฏ ุงููุฑุงุฌุนุฉ -->
        <h5 class="text-warning"><i class="bi bi-hourglass-split"></i> ุทูุจุงุช ุงูุณุญุจ ููุฏ ุงููุฑุงุฌุนุฉ</h5>
        <table class="table table-hover align-middle">
          <thead>
            <tr>
              <th>๐ ุชุงุฑูุฎ ุงูุทูุจ</th>
              <th>๐ฐ ุงููุจูุบ</th>
              <th>๐ฆ ุงูุจูู</th>
              <th>๐ณ ุฑูู ุงูุญุณุงุจ</th>
              <th>๐ข ุงูุขูุจุงู</th>
              <th>๐ค ุตุงุญุจ ุงูุญุณุงุจ</th>
              <th>๐ง ุงููุณูุท</th>
              <th>โ ุงูุฅุฌุฑุงุก</th>
            </tr>
          </thead>
          <tbody>
            {% for request in pending_withdrawals[:12] %}
            <tr>
              <td>{{ request.created_at.strftime('%Y-%m-%d') }}</td>
              <td>{{ request.amount }} ุฑูุงู</td>
              <td>{{ request.bank_name }}</td>
              <td>{{ request.account_number }}</td>
              <td>{{ request.iban_number }}</td>
              <td>{{ request.account_holder }}</td>
              <td>{{ request.intermediary.username }}</td>
              <td>
                <a href="{{ url_for('main_routes.approve_withdrawal', withdrawal_id=request.id) }}" class="btn btn-success btn-sm rounded-pill shadow-sm">
                  โ ูุจูู
                </a>
                <a href="{{ url_for('main_routes.reject_withdrawal', withdrawal_id=request.id) }}" class="btn btn-danger btn-sm rounded-pill shadow-sm">
                  โ ุฑูุถ
                </a>
              </td>
            </tr>
            {% else %}
            <tr>
              <td colspan="8" class="text-center">ูุง ุชูุฌุฏ ุทูุจุงุช ุณุญุจ ููุฏ ุงููุฑุงุฌุนุฉ.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% if pending_withdrawals|length > 12 %}
        <div class="d-flex justify-content-center mt-3">
          <a href="{{ url_for('dashboard_pending_withdrawals_page', page=2) }}" class="btn btn-outline-primary rounded-pill shadow-sm">ุงูุชุงูู</a>
        </div>
        {% endif %}

        <hr>

        <!-- ุจ. ุทูุจุงุช ุงูุณุญุจ ุงูููุจููุฉ -->
        <h5 class="text-success"><i class="bi bi-check-circle"></i> ุทูุจุงุช ุงูุณุญุจ ุงูููุจููุฉ</h5>
        <table class="table table-hover align-middle">
          <thead>
            <tr>
              <th>๐ ุชุงุฑูุฎ ุงูุทูุจ</th>
              <th>๐ฐ ุงููุจูุบ</th>
              <th>๐ฆ ุงูุจูู</th>
              <th>๐ณ ุฑูู ุงูุญุณุงุจ</th>
              <th>๐ข ุงูุขูุจุงู</th>
              <th>๐ค ุตุงุญุจ ุงูุญุณุงุจ</th>
              <th>๐ง ุงููุณูุท</th>
              <th>๐ ุงูุชุฑุงุฌุน</th>
            </tr>
          </thead>
          <tbody>
            {% for request in approved_withdrawals[:12] %}
            <tr>
              <td>{{ request.created_at.strftime('%Y-%m-%d') }}</td>
              <td>{{ request.amount }} ุฑูุงู</td>
              <td>{{ request.bank_name }}</td>
              <td>{{ request.account_number }}</td>
              <td>{{ request.iban_number }}</td>
              <td>{{ request.account_holder }}</td>
              <td>{{ request.intermediary.username }}</td>
              <td>
                <a href="{{ url_for('main_routes.revert_withdrawal', withdrawal_id=request.id) }}" class="btn btn-warning btn-sm rounded-pill shadow-sm">
                  ๐ ุชุฑุงุฌุน
                </a>
              </td>
            </tr>
            {% else %}
            <tr>
              <td colspan="8" class="text-center">ูุง ุชูุฌุฏ ุทูุจุงุช ุณุญุจ ููุจููุฉ.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% if approved_withdrawals|length > 12 %}
        <div class="d-flex justify-content-center mt-3">
          <a href="{{ url_for('dashboard_approved_withdrawals_page', page=2) }}" class="btn btn-outline-primary rounded-pill shadow-sm">ุงูุชุงูู</a>
        </div>
        {% endif %}

        <hr>

        <!-- ุฌ. ุทูุจุงุช ุงูุณุญุจ ุงููุฑููุถุฉ -->
        <h5 class="text-danger"><i class="bi bi-x-circle"></i> ุทูุจุงุช ุงูุณุญุจ ุงููุฑููุถุฉ</h5>
        <table class="table table-hover align-middle">
          <thead>
            <tr>
              <th>๐ ุชุงุฑูุฎ ุงูุทูุจ</th>
              <th>๐ฐ ุงููุจูุบ</th>
              <th>๐ฆ ุงูุจูู</th>
              <th>๐ณ ุฑูู ุงูุญุณุงุจ</th>
              <th>๐ข ุงูุขูุจุงู</th>
              <th>๐ค ุตุงุญุจ ุงูุญุณุงุจ</th>
              <th>๐ง ุงููุณูุท</th>
              <th>๐ ุงูุชุฑุงุฌุน</th>
            </tr>
          </thead>
          <tbody>
            {% for request in rejected_withdrawals[:12] %}
            <tr>
              <td>{{ request.created_at.strftime('%Y-%m-%d') }}</td>
              <td>{{ request.amount }} ุฑูุงู</td>
              <td>{{ request.bank_name }}</td>
              <td>{{ request.account_number }}</td>
              <td>{{ request.iban_number }}</td>
              <td>{{ request.account_holder }}</td>
              <td>{{ request.intermediary.username }}</td>
              <td>
                <a href="{{ url_for('main_routes.revert_withdrawal', withdrawal_id=request.id) }}" class="btn btn-warning btn-sm rounded-pill shadow-sm">
                  ๐ ุชุฑุงุฌุน
                </a>
              </td>
            </tr>
            {% else %}
            <tr>
              <td colspan="8" class="text-center">ูุง ุชูุฌุฏ ุทูุจุงุช ุณุญุจ ูุฑููุถุฉ.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% if rejected_withdrawals|length > 12 %}
        <div class="d-flex justify-content-center mt-3">
          <a href="{{ url_for('dashboard_rejected_withdrawals_page', page=2) }}" class="btn btn-outline-primary rounded-pill shadow-sm">ุงูุชุงูู</a>
        </div>
        {% endif %}

      </div>
    </div>
  </div>

  <!-- 11. ูุงุฆูุฉ ุงููุณุทุงุก ุงููุณุฌููู -->
  <div id="intermediariesSection" class="dashboard-section" style="display:none;">
    <div class="card shadow mb-4">
      <div class="card-header bg-dark text-white">
        <h4 class="mb-0"><i class="bi bi-people"></i> ุงููุณุทุงุก ุงููุณุฌููู</h4>
      </div>
      <div class="card-body table-responsive">
        <table class="table table-hover align-middle">
          <thead>
            <tr>
              <th>๐ค ุงูุงุณู</th>
              <th>๐ง ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</th>
              <th>๐ ุฑูู ุงูุฌูุงู</th>
              <th>๐ด ุญุงูุฉ ุงูุญุณุงุจ</th>
              <th>๐ ุงูุชูุงุตูู</th>
              <th>โ๏ธ ุงูุฅุฌุฑุงุกุงุช</th>
            </tr>
          </thead>
          <tbody>
            {% for intermediary in intermediaries[:12] %}
            <tr>
              <td>
                <a href="{{ url_for('main_routes.intermediary_details', intermediary_id=intermediary.id) }}" class="text-decoration-none">
                  <i class="bi bi-person-circle"></i> {{ intermediary.username }}
                </a>
              </td>
              <td>{{ intermediary.email }}</td>
              <td>{{ intermediary.phone or "ุบูุฑ ูุชููุฑ" }}</td>
              <td>
                {% if intermediary.status == "active" %}
                  <span class="badge bg-success">โ ูุดุท</span>
                {% elif intermediary.status == "suspended" %}
                  <span class="badge bg-danger">โ ููููู</span>
                {% else %}
                  <span class="badge bg-warning">โณ ุชุญุช ุงููุฑุงุฌุนุฉ</span>
                {% endif %}
              </td>
              <td>
                <a href="{{ url_for('main_routes.intermediary_details', intermediary_id=intermediary.id) }}" class="btn btn-sm btn-info rounded-pill shadow-sm">
                  <i class="bi bi-eye"></i> ุนุฑุถ ุงูุชูุงุตูู
                </a>
              </td>
              <td>
                <form method="POST" action="{{ url_for('main_routes.update_user_status', user_id=intermediary.id) }}">
                  <select class="form-select form-select-sm d-inline-block w-auto" name="new_status">
                    <option value="active" {% if intermediary.status == "active" %}selected{% endif %}>โ ูุดุท</option>
                    <option value="suspended" {% if intermediary.status == "suspended" %}selected{% endif %}>โ ููููู</option>
                    <option value="under_review" {% if intermediary.status == "under_review" %}selected{% endif %}>โณ ุชุญุช ุงููุฑุงุฌุนุฉ</option>
                  </select>
                  <button type="submit" class="btn btn-sm btn-primary rounded-pill shadow-sm">
                    <i class="bi bi-save"></i> ุชุญุฏูุซ
                  </button>
                </form>
              </td>
            </tr>
            {% else %}
            <tr>
              <td colspan="6" class="text-center">ูุง ููุฌุฏ ูุณุทุงุก ูุณุฌููู.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% if intermediaries|length > 12 %}
        <div class="d-flex justify-content-center mt-3">
          <a href="{{ url_for('dashboard_intermediaries_page', page=2) }}" class="btn btn-outline-primary rounded-pill shadow-sm">ุงูุชุงูู</a>
        </div>
        {% endif %}
      </div>
    </div>
  </div>

</div>

<!-- ุฌุงูุง ุณูุฑูุจุช ูุชุจุฏูู ุนุฑุถ ุงูุฃูุณุงู -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const tabs = document.querySelectorAll('#dashboardTabs a');
  const sections = document.querySelectorAll('.dashboard-section');
  
  tabs.forEach(function(tab) {
    tab.addEventListener('click', function(e) {
      e.preventDefault();
      // ุฅุฒุงูุฉ ุชูุนูู ุฌููุน ุงูุชุจููุจุงุช ูุฅุฎูุงุก ุงูุฃูุณุงู
      tabs.forEach(t => t.classList.remove('active'));
      sections.forEach(section => section.style.display = 'none');
      // ุชูุนูู ุงูุชุจููุจ ุงููุฎุชุงุฑ ูุนุฑุถ ุงููุณู ุงููุทุงุจู
      tab.classList.add('active');
      const targetId = tab.getAttribute('data-target');
      const targetSection = document.getElementById(targetId);
      if (targetSection) {
        targetSection.style.display = 'block';
      }
    });
  });
});
</script>


<script>
  document.getElementById("myForm").addEventListener("submit", function(e) {
    e.preventDefault(); // ููุน ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ
    let formData = new FormData(this);
    fetch(this.action, {
      method: 'POST',
      body: formData
    })
    .then(response => response.json())
    .then(data => {
      // ุชุญุฏูุซ ุนูุงุตุฑ ุงูุตูุญุฉ ุจูุงุกู ุนูู ุจูุงูุงุช ุงูุงุณุชุฌุงุจุฉ
      console.log(data);
    })
    .catch(error => console.error('Error:', error));
  });
  </script>
  
{% endblock %}
