{% extends "base1.html" %}

{% block title %}Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø´Ø±Ù{% endblock %}

{% block content %}
<div class="container-fluid p-4">

  <!-- Ø¹Ù†ÙˆØ§Ù† Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
  <div class="row mb-4">
    <div class="col text-center">
      <h2 class="display-4">
        <i class="bi bi-speedometer2"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø§Ù„Ù…Ø´Ø±Ù
      </h2>
    </div>
  </div>

  <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªÙ†Ù‚Ù„ Ù„Ù„Ø£Ù‚Ø³Ø§Ù… -->
  <ul class="nav nav-tabs mb-4" id="dashboardTabs">
    <li class="nav-item">
      <a class="nav-link active" href="#" data-target="statisticsSection">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ø§Ù…Ø©</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#" data-target="ordersSection">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª (Ø¹Ø±Ø¶)</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#" data-target="editOrdersSection">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª (ØªØ­Ø±ÙŠØ±)</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#" data-target="newOrderSection">Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#" data-target="pendingReviewSection">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#" data-target="approvedSection">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„Ø©</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#" data-target="rejectedSection">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¶Ø©</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#" data-target="factoryAgreementSection">Ø¥Ù†Ø´Ø§Ø¡ Ø§ØªÙØ§Ù‚ Ø§Ù„Ù…ØµÙ†Ø¹</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#" data-target="factoryAgreementsSection">Ø§Ù„Ø§ØªÙØ§Ù‚Ø§Øª Ø§Ù„Ù…Ø¨Ø±Ù…Ø©</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#" data-target="withdrawalsSection">Ø¥Ø¯Ø§Ø±Ø© Ø·Ù„Ø¨Ø§Øª Ø³Ø­Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#" data-target="intermediariesSection">Ø§Ù„ÙˆØ³Ø·Ø§Ø¡ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†</a>
    </li>
  </ul>

  <!-- Ø§Ù„Ø£Ù‚Ø³Ø§Ù… -->

  <!-- 1. Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ø§Ù…Ø© -->
  <div id="statisticsSection" class="dashboard-section">
    <div class="row mb-4">
      <div class="col-12">
        <div class="card shadow mb-4">
          <div class="card-header bg-info text-white">
            <h4 class="mb-0">
              <i class="bi bi-bar-chart"></i> Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ø§Ù…Ø©
            </h4>
          </div>
          <div class="card-body">
            <div class="row text-center">
              <div class="col-md-3 mb-3">
                <div class="card border-info h-100">
                  <div class="card-body">
                    <h5 class="card-title">Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h5>
                    <p class="card-text display-6">{{ orders | length }}</p>
                  </div>
                </div>
              </div>
              <div class="col-md-3 mb-3">
                <div class="card border-info h-100">
                  <div class="card-body">
                    <h5 class="card-title">Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ³Ø·Ø§Ø¡</h5>
                    <p class="card-text display-6">{{ intermediaries | length }}</p>
                  </div>
                </div>
              </div>
              <div class="col-md-3 mb-3">
                <div class="card border-success h-100">
                  <div class="card-body">
                    <h5 class="card-title">Ø·Ù„Ø¨Ø§Øª Ù…ÙƒØªÙ…Ù„Ø©</h5>
                    <p class="card-text display-6">{{ completed_orders }}</p>
                  </div>
                </div>
              </div>
              <div class="col-md-3 mb-3">
                <div class="card border-warning h-100">
                  <div class="card-body">
                    <h5 class="card-title">Ø·Ù„Ø¨Ø§Øª Ù…ÙØªÙˆØ­Ø©</h5>
                    <p class="card-text display-6">{{ open_orders }}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ğŸ“¨ Ù‚Ø³Ù… Ø±Ø³Ø§Ø¦Ù„ "ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§" -->
    <h3>ğŸ“¨ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ÙˆØ§Ø±Ø¯Ø©</h3>
    <div class="card shadow mb-4">
      <div class="card-header bg-primary text-white">
        <h4 class="mb-0"><i class="bi bi-envelope"></i> Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ÙˆØ§Ø±Ø¯Ø©</h4>
      </div>
      <div class="card-body">
        {% if messages %}
          <div class="list-group">
            {% for message in messages %}
              <div class="list-group-item list-group-item-action flex-column align-items-start">
                <div class="d-flex w-100 justify-content-between">
                  <h5 class="mb-1"><i class="bi bi-person"></i> {{ message.name }}</h5>
                  <small class="text-muted">{{ message.created_at.strftime('%Y-%m-%d %H:%M') }}</small>
                </div>
                <p class="mb-1"><i class="bi bi-envelope-at"></i> <strong>{{ message.email }}</strong></p>
                <p class="text-dark"><i class="bi bi-chat-dots"></i> {{ message.content }}</p>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="alert alert-info text-center">
            ğŸš€ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„ Ø¬Ø¯ÙŠØ¯Ø©.
          </div>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- 2. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª (Ø¹Ø±Ø¶) -->
  <div id="ordersSection" class="dashboard-section" style="display:none;">
    <div class="row mb-4">
      <div class="col-12">
        <div class="card shadow mb-4">
          <div class="card-header bg-secondary text-white">
            <h4 class="mb-0">
              <i class="bi bi-folder"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª
            </h4>
          </div>
          <div class="card-body">
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th>
                  <th>Ø§Ø³Ù… Ø§Ù„Ø·Ù„Ø¨</th>
                  <th>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</th>
                  <th>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</th>
                  <th>Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</th>
                  <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
              </thead>
              <tbody>
                {% for order in orders[:12] %}
                <tr>
                  <td>{{ order.id }}</td>
                  <td>{{ order.name }}</td>
                  <td>{{ order.quantity_needed }}</td>
                  <td>{{ order.quantity_covered }}</td>
                  <td>
                    {% if order.quantity_covered >= order.quantity_needed %}
                      <span class="badge bg-success">Ù…ÙƒØªÙ…Ù„Ø©</span>
                    {% else %}
                      <span class="badge bg-warning text-dark">Ù…ÙØªÙˆØ­Ø©</span>
                    {% endif %}
                  </td>
                  <td>
                    <form method="POST" action="{{ url_for('main_routes.delete_order', order_id=order.id) }}" onsubmit="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø·Ù„Ø¨ÙŠØ©ØŸ')">
                      <button type="submit" class="btn btn-danger btn-sm rounded-pill shadow-sm">
                        <i class="bi bi-trash"></i> Ø­Ø°Ù
                      </button>
                    </form>
                  </td>
                </tr>
                {% else %}
                <tr>
                  <td colspan="6" class="text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª.</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 3. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª (ØªØ­Ø±ÙŠØ±) -->
  <div id="editOrdersSection" class="dashboard-section" style="display:none;">
    <div class="row mb-4">
      <div class="col-12">
        <div class="card shadow mb-4">
          <div class="card-header bg-secondary text-white">
            <h4 class="mb-0">
              <i class="bi bi-folder"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª
            </h4>
          </div>
          <div class="card-body">
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th>
                  <th>Ø§Ø³Ù… Ø§Ù„Ø·Ù„Ø¨ÙŠØ©</th>
                  <th>ÙˆØµÙ Ø§Ù„Ø·Ù„Ø¨ÙŠØ©</th>
                  <th>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</th>
                  <th>Ø§Ù„Ø³Ø¹Ø± Ù„ÙƒÙ„ ÙƒØ±ØªÙˆÙ†Ø©</th>
                  <th>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©</th>
                  <th>Ø§Ù„Ø±Ø¨Ø­ Ù„ÙƒÙ„ ÙƒØ±ØªÙˆÙ†Ø©</th>
                  <th>Ø§Ù„Ù…Ø¯Ù† Ø§Ù„Ù…ØªØ§Ø­Ø©</th>
                  <th>Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚</th>
                  <th>Ù…ÙˆØ¹Ø¯ Ø§Ù„ØªØ³Ù„ÙŠÙ…</th>
                  <th>ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬</th>
                  <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
              </thead>
              <tbody>
                {% for order in orders[:12] %}
                <tr>
                  <form method="POST" action="{{ url_for('main_routes.update_order', order_id=order.id) }}" enctype="multipart/form-data">
                    <td>{{ order.id }}</td>
                    <td><input type="text" name="name" value="{{ order.name }}" class="form-control form-control-sm"></td>
                    <td><textarea name="description" class="form-control form-control-sm">{{ order.description }}</textarea></td>
                    <td><input type="number" name="quantity_needed" value="{{ order.quantity_needed }}" class="form-control form-control-sm"></td>
                    <td><input type="number" name="price_per_carton" value="{{ order.price_per_carton }}" step="0.01" class="form-control form-control-sm"></td>
                    <td><input type="number" name="min_contribution" value="{{ order.min_contribution }}" class="form-control form-control-sm"></td>
                    <td><input type="number" name="earnings_per_carton" value="{{ order.earnings_per_carton }}" step="0.1" class="form-control form-control-sm"></td>
                    <td><input type="text" name="cities_available" value="{{ order.cities_available }}" class="form-control form-control-sm"></td>
                    <td><input type="date" name="closing_date" value="{{ order.closing_date }}" class="form-control form-control-sm"></td>
                    <td><input type="date" name="delivery_date" value="{{ order.delivery_date }}" class="form-control form-control-sm"></td>
                    <td>
                      {% if order.image_url and order.image_url.startswith('http') %} 
                      <a href="{{ order.image_url }}" target="_blank">
                          <img src="{{ order.image_url }}" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬" width="80" height="80" style="object-fit: cover;">
                      </a>
                      {% else %}
                      Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØµÙˆØ±Ø©
                      {% endif %}
                   
                      <!-- Ø®ÙŠØ§Ø± Ø±ÙØ¹ ØµÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø© -->
                      <form method="POST" action="{{ url_for('main_routes.update_order', order_id=order.id) }}" enctype="multipart/form-data" class="mt-2">
                        <input type="file" name="product_image" class="form-control form-control-sm">
                        <button type="submit" class="btn btn-primary btn-sm rounded-pill shadow-sm mt-1">
                          <i class="bi bi-upload"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙˆØ±Ø©
                        </button>
                      </form>
                    </td>
                    <td>
                      <button type="submit" class="btn btn-primary btn-sm rounded-pill shadow-sm">
                        <i class="bi bi-pencil"></i> ØªØ­Ø±ÙŠØ±
                      </button>
                      <form method="POST" action="{{ url_for('main_routes.delete_order', order_id=order.id) }}" style="display:inline;">
                        <button type="submit" class="btn btn-danger btn-sm rounded-pill shadow-sm">
                          <i class="bi bi-trash"></i> Ø­Ø°Ù
                        </button>
                      </form>
                    </td>
                  </form>
                </tr>
                {% else %}
                <tr>
                  <td colspan="12" class="text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª.</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 4. Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø© -->
  <div id="newOrderSection" class="dashboard-section" style="display:none;">
    <div class="row mb-4">
      <div class="col-12">
        <div class="card shadow mb-4">
          <div class="card-header bg-primary text-white">
            <h4 class="mb-0">
              <i class="bi bi-plus-circle"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©
            </h4>
          </div>
          <div class="card-body">
            <form method="POST" action="{{ url_for('main_routes.dashboard') }}" enctype="multipart/form-data">
              <div class="row">
                <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬ -->
                <div class="col-md-6">
                  <h5>
                    <i class="bi bi-bag"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬
                  </h5>
                  <div class="mb-3">
                    <label for="product_name" class="form-label">Ø§Ø³Ù… Ø§Ù„Ø·Ù„Ø¨ÙŠØ©</label>
                    <input type="text" class="form-control" id="product_name" name="product_name" required>
                  </div>
                  <div class="mb-3">
                    <label for="description" class="form-label">ÙˆØµÙ Ø§Ù„Ø·Ù„Ø¨ÙŠØ©</label>
                    <textarea class="form-control" id="description" name="description" rows="2" required></textarea>
                  </div>
                  <div class="mb-3">
                    <label for="product_image" class="form-label">ğŸ“· ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                    <input type="file" class="form-control" id="product_image" name="product_image">
                  </div>
                </div>
                <!-- Ø§Ù„ÙƒÙ…ÙŠØ§Øª ÙˆØ§Ù„ØªØ³Ø¹ÙŠØ± -->
                <div class="col-md-6">
                  <h5>
                    <i class="bi bi-currency-dollar"></i> Ø§Ù„ÙƒÙ…ÙŠØ§Øª ÙˆØ§Ù„ØªØ³Ø¹ÙŠØ±
                  </h5>
                  <div class="mb-3">
                    <label for="quantity" class="form-label">Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</label>
                    <input type="number" class="form-control" id="quantity" name="quantity" required>
                  </div>
                  <div class="mb-3">
                    <label for="price_per_carton" class="form-label">Ø§Ù„Ø³Ø¹Ø± Ù„ÙƒÙ„ ÙƒØ±ØªÙˆÙ†Ø©</label>
                    <input type="number" class="form-control" id="price_per_carton" name="price_per_carton" step="0.01" required>
                  </div>
                  <div class="mb-3">
                    <label for="min_participation" class="form-label">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©</label>
                    <input type="number" class="form-control" id="min_participation" name="min_participation" required>
                  </div>
                </div>

                <!-- ğŸ”¹ Ø­Ù‚Ù„ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø¶ØºÙˆØ· -->
                <div class="row">
                  <div class="col-12">
                    <h5><i class="bi bi-file-earmark-zip"></i> Ù…Ù„Ù Ø§Ù„Ø·Ù„Ø¨ÙŠØ© (ZIP)</h5>
                    <div class="mb-3">
                      <label for="zip_file" class="form-label">ğŸ“¦ Ø±ÙØ¹ Ù…Ù„Ù Ø§Ù„Ø·Ù„Ø¨ÙŠØ© Ø§Ù„Ù…Ø¶ØºÙˆØ· (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                      <input type="file" class="form-control" id="zip_file" name="zip_file" accept=".zip">
                    </div>
                  </div>
                </div>

                <div class="mb-3">
                  <label for="features" class="form-label">Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                  <div id="feature-container">
                    <div class="input-group mb-2">
                      <input type="text" class="form-control" name="features[]" placeholder="Ù…ÙŠØ²Ø© 1">
                      <button type="button" class="btn btn-danger remove-feature">ğŸ—‘ï¸</button>
                    </div>
                  </div>
                  <button type="button" class="btn btn-primary" id="add-feature">â• Ø¥Ø¶Ø§ÙØ© Ù…ÙŠØ²Ø©</button>
                </div>
                
                <script>
                  document.getElementById("add-feature").addEventListener("click", function () {
                    let featureContainer = document.getElementById("feature-container");
                    let newFeature = document.createElement("div");
                    newFeature.classList.add("input-group", "mb-2");
                    newFeature.innerHTML = `
                      <input type="text" class="form-control" name="features[]" placeholder="Ù…ÙŠØ²Ø© Ø¬Ø¯ÙŠØ¯Ø©">
                      <button type="button" class="btn btn-danger remove-feature">ğŸ—‘ï¸</button>
                    `;
                    featureContainer.appendChild(newFeature);
                  });
                
                  document.addEventListener("click", function (e) {
                    if (e.target.classList.contains("remove-feature")) {
                      e.target.parentElement.remove();
                    }
                  });
                </script>
              </div>

              <hr>

              <!-- Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„ÙˆØ³ÙŠØ· -->
              <div class="mb-3">
                <h5>
                  <i class="bi bi-award"></i> Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„ÙˆØ³ÙŠØ·
                </h5>
                <label for="earnings_per_carton" class="form-label">ğŸ”¢ Ø§Ù„Ø±Ø¨Ø­ Ù„ÙƒÙ„ ÙƒØ±ØªÙˆÙ†Ø©</label>
                <input type="number" class="form-control" id="earnings_per_carton" name="earnings_per_carton" step="0.1" placeholder="Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø±Ø¨Ø­ Ù„ÙƒÙ„ ÙƒØ±ØªÙˆÙ†Ø©" required>
              </div>

              <hr>

              <!-- Ø´Ø±ÙˆØ· Ø§Ù„Ø¯ÙØ¹ ÙˆØ§Ù„ØªØ³Ù„ÙŠÙ… -->
              <div class="row">
                <div class="col-md-4">
                  <h5>
                    <i class="bi bi-building"></i> Ø§Ù„Ù…Ø¯Ù† Ø§Ù„Ù…ØªØ§Ø­Ø©
                  </h5>
                  <div class="mb-3">
                    <label for="city" class="form-label">ğŸ™ï¸ Ø§Ù„Ù…Ø¯Ù† Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„Ù„ØªØ³Ù„ÙŠÙ…</label>
                    <input type="text" class="form-control" id="city" name="city" required>
                  </div>
                </div>
                <div class="col-md-4">
                  <h5>
                    <i class="bi bi-calendar3"></i> Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø·Ù„Ø¨ÙŠØ©
                  </h5>
                  <div class="mb-3">
                    <label for="order_deadline" class="form-label">ğŸ“… Ù…ÙˆØ¹Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø·Ù„Ø¨ÙŠØ©</label>
                    <input type="date" class="form-control" id="order_deadline" name="order_deadline" required>
                  </div>
                </div>
                <div class="col-md-4">
                  <h5>
                    <i class="bi bi-truck"></i> Ù…ÙˆØ¹Ø¯ Ø§Ù„ØªØ³Ù„ÙŠÙ…
                  </h5>
                  <div class="mb-3">
                    <label for="delivery_date" class="form-label">ğŸšš Ù…ÙˆØ¹Ø¯ Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</label>
                    <input type="date" class="form-control" id="delivery_date" name="delivery_date" required>
                  </div>
                </div>
              </div>
              <div class="text-end">
                <button type="submit" class="btn btn-success rounded-pill shadow-sm">
                  <i class="bi bi-check-circle"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨ÙŠØ©
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 5. Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© -->
  <div id="pendingReviewSection" class="dashboard-section" style="display:none;">
    <div class="row mb-4">
      <div class="col-12">
        <div class="card shadow mb-4">
          <div class="card-header bg-warning text-dark">
            <h4 class="mb-0">
              <i class="bi bi-clock-history"></i> Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©
            </h4>
          </div>
          <div class="card-body">
            <table class="table table-bordered table-hover">
              <thead>
                <tr>
                  <th>Ø§Ù„Ù…ØªØ¬Ø±</th>
                  <th>Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
                  <th>Ø§Ù„ÙˆØ³ÙŠØ·</th>
                  <th>Ø¹Ø¯Ø¯ Ø§Ù„ÙƒØ±Ø§ØªÙŠÙ†</th>
                  <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</th>
                  <th>ğŸ‘¤ Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</th>
                  <th>ğŸ“± Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</th>
                  <th>Ø±Ø§Ø¨Ø· Ø§Ù„Ø·Ù„Ø¨ÙŠØ©</th>
                  <th>Ø±Ø§Ø¨Ø· ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                  <th>ğŸ“œ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ</th>
                  <th>ğŸª ØµÙˆØ±Ø© Ø§Ù„Ù…Ø­Ù„</th>
                  <th>Ø§Ù„Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ù…Ø§Ù„ÙŠ</th>
                  <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
              </thead>
              <tbody>
                {% for participant in pending_orders[:12] %}
                <tr>
                  <td>{{ participant.store_name }}</td>
                  <td>{{ participant.location }}</td>
                  <td>{{ participant.intermediary.username }}</td>
                  <td>{{ participant.cartons_requested }}</td>
                  <td>{{ participant.cartons_requested * participant.order.price_per_carton }} Ø±ÙŠØ§Ù„</td>
                  <td>{{ participant.responsible_person }}</td>
                  <td>{{ participant.customer_phone }}</td>
                  <td>
                    <a href="{{ url_for('main_routes.order_details', order_id=participant.order.id) }}" target="_blank" class="btn btn-sm btn-info rounded-pill shadow-sm">
                      <i class="bi bi-link"></i> Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨ÙŠØ©
                    </a>
                  </td>
                  <td>
                    <a href="{{ url_for('main_routes.customer_order_details', participant_id=participant.id) }}" target="_blank" class="btn btn-sm btn-primary rounded-pill shadow-sm">
                      <i class="bi bi-eye"></i> Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„
                    </a>
                  </td>
                  <td>
                    {% if participant.commercial_record %}
                      <a href="{{ participant.commercial_record }}" target="_blank">
                          <img src="{{ participant.commercial_record }}" alt="Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ" width="80" height="80" style="object-fit: cover;">
                      </a>
                    {% else %}
                      Ù„Ø§ ÙŠÙˆØ¬Ø¯
                    {% endif %}
                  </td>
                  <td>
                    {% if participant.store_sign %}
                      <a href="{{ participant.store_sign }}" target="_blank">
                          <img src="{{ participant.store_sign }}" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ø­Ù„" width="80" height="80" style="object-fit: cover;">
                      </a>
                    {% else %}
                      Ù„Ø§ ÙŠÙˆØ¬Ø¯
                    {% endif %}
                  </td>
                  <td>
                    {% if participant.payment_receipt %}
                      <a href="{{ participant.payment_receipt }}" target="_blank">
                          <img src="{{ participant.payment_receipt }}" alt="Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ø¯ÙØ¹" width="80" height="80" style="object-fit: cover;">
                      </a>
                    {% else %}
                      Ù„Ø§ ÙŠÙˆØ¬Ø¯
                    {% endif %}
                  </td>
                  <td>
                    <form method="POST" action="{{ url_for('main_routes.approve_order', participant_id=participant.id) }}" style="display:inline;">
                      <button type="submit" class="btn btn-success btn-sm rounded-pill shadow-sm">
                        <i class="bi bi-check"></i> Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨
                      </button>
                    </form>
                    <form method="POST" action="{{ url_for('main_routes.reject_order', participant_id=participant.id) }}" style="display:inline;">
                      <button type="submit" class="btn btn-danger btn-sm rounded-pill shadow-sm">
                        <i class="bi bi-x"></i> Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨
                      </button>
                    </form>
                  </td>
                </tr>
                {% else %}
                <tr>
                  <td colspan="13" class="text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø© Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©.</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 6. Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„Ø© -->
  <div id="approvedSection" class="dashboard-section" style="display:none;">
    <div class="row mb-4">
      <div class="col-12">
        <div class="card shadow mb-4">
          <div class="card-header bg-success text-white">
            <h4 class="mb-0">
              <i class="bi bi-check2-circle"></i> Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„Ø©
            </h4>
          </div>
          <div class="card-body">
            <table class="table table-bordered table-hover">
              <thead>
                <tr>
                  <th>Ø§Ù„ÙˆØ³ÙŠØ·</th>
                  <th>Ø§Ù„Ù…ØªØ¬Ø±</th>
                  <th>Ø¹Ø¯Ø¯ Ø§Ù„ÙƒØ±Ø§ØªÙŠÙ†</th>
                  <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹</th>
                  <th>Ø±Ø§Ø¨Ø· Ø§Ù„Ø·Ù„Ø¨ÙŠØ©</th>
                  <th>Ø±Ø§Ø¨Ø· ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                  <th>Ø§Ù„Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ù…Ø§Ù„ÙŠ</th>
                  <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
              </thead>
              <tbody>
                {% for participant in approved_orders[:12] %}
                <tr>
                  <td>{{ participant.intermediary.username }}</td>
                  <td>{{ participant.store_name }}</td>
                  <td>{{ participant.cartons_requested }}</td>
                  <td>{{ participant.cartons_requested * participant.order.price_per_carton }} Ø±ÙŠØ§Ù„</td>
                  <td>
                    <a href="{{ url_for('main_routes.order_details', order_id=participant.order.id) }}" target="_blank" class="btn btn-sm btn-info rounded-pill shadow-sm">
                      <i class="bi bi-link"></i> Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨ÙŠØ©
                    </a>
                  </td>
                  <td>
                    <a href="{{ url_for('main_routes.customer_order_details', participant_id=participant.id) }}" target="_blank" class="btn btn-sm btn-primary rounded-pill shadow-sm">
                      <i class="bi bi-eye"></i> Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„
                    </a>
                  </td>
                  <td>
                    {% if participant.payment_receipt %}
                      <a href="{{ participant.payment_receipt }}" target="_blank">
                          <img src="{{ participant.payment_receipt }}" alt="Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ø¯ÙØ¹" width="80" height="80" style="object-fit: cover;">
                      </a>
                    {% else %}
                      Ù„Ø§ ÙŠÙˆØ¬Ø¯
                    {% endif %}
                  </td>
                  <td>
                    <form method="POST" action="{{ url_for('main_routes.revert_order', participant_id=participant.id) }}">
                      <button type="submit" class="btn btn-warning btn-sm rounded-pill shadow-sm">
                        <i class="bi bi-arrow-counterclockwise"></i> ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ø§Ù„Ù‚Ø¨ÙˆÙ„
                      </button>
                    </form>
                  </td>
                </tr>
                {% else %}
                <tr>
                  <td colspan="8" class="text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ù‚Ø¨ÙˆÙ„Ø©.</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 7. Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¶Ø© -->
  <div id="rejectedSection" class="dashboard-section" style="display:none;">
    <div class="row mb-4">
      <div class="col-12">
        <div class="card shadow mb-4">
          <div class="card-header bg-danger text-white">
            <h4 class="mb-0">
              <i class="bi bi-x-circle"></i> Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¶Ø©
            </h4>
          </div>
          <div class="card-body">
            <table class="table table-bordered table-hover">
              <thead>
                <tr>
                  <th>Ø§Ù„ÙˆØ³ÙŠØ·</th>
                  <th>Ø§Ù„Ù…ØªØ¬Ø±</th>
                  <th>Ø¹Ø¯Ø¯ Ø§Ù„ÙƒØ±Ø§ØªÙŠÙ†</th>
                  <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø°ÙŠ ÙƒØ§Ù† Ù…Ø·Ù„ÙˆØ¨Ù‹Ø§</th>
                  <th>Ø±Ø§Ø¨Ø· Ø§Ù„Ø·Ù„Ø¨ÙŠØ©</th>
                  <th>Ø±Ø§Ø¨Ø· ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                  <th>Ø§Ù„Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ù…Ø§Ù„ÙŠ</th>
                  <th>Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶</th>
                </tr>
              </thead>
              <tbody>
                {% for participant in rejected_orders[:12] %}
                <tr>
                  <td>{{ participant.intermediary.username }}</td>
                  <td>{{ participant.store_name }}</td>
                  <td>{{ participant.cartons_requested }}</td>
                  <td>{{ participant.cartons_requested * participant.order.price_per_carton }} Ø±ÙŠØ§Ù„</td>
                  <td>
                    <a href="{{ url_for('main_routes.order_details', order_id=participant.order.id) }}" target="_blank" class="btn btn-sm btn-info rounded-pill shadow-sm">
                      <i class="bi bi-link"></i> Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨ÙŠØ©
                    </a>
                  </td>
                  <td>
                    <a href="{{ url_for('main_routes.customer_order_details', participant_id=participant.id) }}" target="_blank" class="btn btn-sm btn-primary rounded-pill shadow-sm">
                      <i class="bi bi-eye"></i> Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„
                    </a>
                  </td>
                  <td>
                    {% if participant.payment_receipt %}
                      <a href="{{ participant.payment_receipt }}" target="_blank">
                          <img src="{{ participant.payment_receipt }}" alt="Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ø¯ÙØ¹" width="80" height="80" style="object-fit: cover;">
                      </a>
                    {% else %}
                      Ù„Ø§ ÙŠÙˆØ¬Ø¯
                    {% endif %}
                  </td>
                  <td>
                    {% if participant.rejection_reason %}
                      {{ participant.rejection_reason }}
                    {% else %}
                      Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø³Ø¨Ø¨
                    {% endif %}
                  </td>
                </tr>
                {% else %}
                <tr>
                  <td colspan="8" class="text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø±ÙÙˆØ¶Ø©.</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 8. Ø¥Ù†Ø´Ø§Ø¡ Ø§ØªÙØ§Ù‚ Ø§Ù„Ù…ØµÙ†Ø¹ -->
  <div id="factoryAgreementSection" class="dashboard-section" style="display:none;">
    <div class="row mb-4">
      <div class="col-12">
        <div class="card shadow mb-4">
          <div class="card-header bg-info text-white">
            <h4 class="mb-0">
              <i class="bi bi-file-earmark-text"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø§ØªÙØ§Ù‚ Ø§Ù„Ù…ØµÙ†Ø¹
            </h4>
          </div>
          <div class="card-body">
            <form method="POST" action="{{ url_for('main_routes.create_factory_agreement') }}">
              <div class="mb-3">
                <label for="order_id" class="form-label">ğŸ“¦ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø·Ù„Ø¨ÙŠØ©</label>
                <select class="form-control" id="order_id" name="order_id" required>
                  <option value="">-- Ø§Ø®ØªØ± Ø·Ù„Ø¨ÙŠØ© --</option>
                  {% for order in orders %}
                    <option value="{{ order.id }}">{{ order.name }}</option>
                  {% endfor %}
                </select>
              </div>
              <div class="mb-3">
                <label for="company_name" class="form-label">ğŸ­ Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©</label>
                <input type="text" class="form-control" id="company_name" name="company_name" required>
              </div>
              <div class="mb-3">
                <label for="carton_price" class="form-label">ğŸ’° Ø³Ø¹Ø± Ø§Ù„ÙƒØ±ØªÙˆÙ†</label>
                <input type="number" class="form-control" id="carton_price" name="carton_price" step="0.01" value="1.5" required>
              </div>
              <button type="submit" class="btn btn-primary rounded-pill shadow-sm">
                <i class="bi bi-link"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§ØªÙØ§Ù‚
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 9. Ø§Ù„Ø§ØªÙØ§Ù‚Ø§Øª Ø§Ù„Ù…Ø¨Ø±Ù…Ø© Ù…Ø¹ Ø§Ù„Ù…ØµØ§Ù†Ø¹ -->
  <div id="factoryAgreementsSection" class="dashboard-section" style="display:none;">
    <div class="row mb-4">
      <div class="col-12">
        <div class="card shadow mb-4">
          <div class="card-header bg-warning text-dark">
            <h4 class="mb-0">
              <i class="bi bi-link"></i> Ø§Ù„Ø§ØªÙØ§Ù‚Ø§Øª Ø§Ù„Ù…Ø¨Ø±Ù…Ø© Ù…Ø¹ Ø§Ù„Ù…ØµØ§Ù†Ø¹
            </h4>
          </div>
          <div class="card-body">
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>Ø±Ù‚Ù… Ø§Ù„Ø§ØªÙØ§Ù‚</th>
                  <th>ğŸ“¦ Ø§Ù„Ø·Ù„Ø¨ÙŠØ©</th>
                  <th>ğŸ­ Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©</th>
                  <th>ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„Ø§ØªÙØ§Ù‚</th>
                  <th>ğŸ“œ Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªÙØ§Ù‚</th>
                </tr>
              </thead>
              <tbody>
                {% for agreement in factory_agreements[:12] %}
                <tr>
                  <td>{{ agreement.id }}</td>
                  <td>{{ agreement.order.name }}</td>
                  <td>{{ agreement.company_name }}</td>
                  <td>
                    <a href="{{ url_for('main_routes.factory_agreement', agreement_link=agreement.agreement_link.replace('factory_agreement/', '')) }}" target="_blank" class="btn btn-sm btn-info rounded-pill shadow-sm">
                      <i class="bi bi-link-45deg"></i> ÙØªØ­ Ø§Ù„Ø§ØªÙØ§Ù‚
                    </a>
                  </td>
                  <td>
                    {% if agreement.status == "pending" %}
                      <span class="badge bg-warning text-dark">ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ù…ØµÙ†Ø¹</span>
                    {% elif agreement.status == "approved" %}
                      <span class="badge bg-success">Ù…ÙØ¹ØªÙ…Ø¯</span>
                    {% else %}
                      <span class="badge bg-danger">Ù…Ø±ÙÙˆØ¶</span>
                    {% endif %}
                  </td>
                </tr>
                {% else %}
                <tr>
                  <td colspan="5" class="text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§ØªÙØ§Ù‚Ø§Øª Ù…Ø¨Ø±Ù…Ø© Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 10. Ø¥Ø¯Ø§Ø±Ø© Ø·Ù„Ø¨Ø§Øª Ø³Ø­Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ -->
  <div id="withdrawalsSection" class="dashboard-section" style="display:none;">
    <div class="card shadow mb-4">
      <div class="card-header bg-info text-white">
        <h4 class="mb-0"><i class="bi bi-wallet"></i> Ø¥Ø¯Ø§Ø±Ø© Ø·Ù„Ø¨Ø§Øª Ø³Ø­Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</h4>
      </div>
      <div class="card-body table-responsive">

        <!-- Ø£. Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© -->
        <h5 class="text-warning"><i class="bi bi-hourglass-split"></i> Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</h5>
        <table class="table table-hover align-middle">
          <thead>
            <tr>
              <th>ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨</th>
              <th>ğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº</th>
              <th>ğŸ¦ Ø§Ù„Ø¨Ù†Ùƒ</th>
              <th>ğŸ’³ Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨</th>
              <th>ğŸ”¢ Ø§Ù„Ø¢ÙŠØ¨Ø§Ù†</th>
              <th>ğŸ‘¤ ØµØ§Ø­Ø¨ Ø§Ù„Ø­Ø³Ø§Ø¨</th>
              <th>ğŸ§‘ Ø§Ù„ÙˆØ³ÙŠØ·</th>
              <th>âœ… Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
            </tr>
          </thead>
          <tbody>
            {% for request in pending_withdrawals[:12] %}
            <tr>
              <td>{{ request.created_at.strftime('%Y-%m-%d') }}</td>
              <td>{{ request.amount }} Ø±ÙŠØ§Ù„</td>
              <td>{{ request.bank_name }}</td>
              <td>{{ request.account_number }}</td>
              <td>{{ request.iban_number }}</td>
              <td>{{ request.account_holder }}</td>
              <td>{{ request.intermediary.username }}</td>
              <td>
                <a href="{{ url_for('main_routes.approve_withdrawal', withdrawal_id=request.id) }}" class="btn btn-success btn-sm rounded-pill shadow-sm">
                  âœ… Ù‚Ø¨ÙˆÙ„
                </a>
                <a href="{{ url_for('main_routes.reject_withdrawal', withdrawal_id=request.id) }}" class="btn btn-danger btn-sm rounded-pill shadow-sm">
                  âŒ Ø±ÙØ¶
                </a>
              </td>
            </tr>
            {% else %}
            <tr>
              <td colspan="8" class="text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø³Ø­Ø¨ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>

        <hr>

        <!-- Ø¨. Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„Ø© -->
        <h5 class="text-success"><i class="bi bi-check-circle"></i> Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„Ø©</h5>
        <table class="table table-hover align-middle">
          <thead>
            <tr>
              <th>ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨</th>
              <th>ğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº</th>
              <th>ğŸ¦ Ø§Ù„Ø¨Ù†Ùƒ</th>
              <th>ğŸ’³ Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨</th>
              <th>ğŸ”¢ Ø§Ù„Ø¢ÙŠØ¨Ø§Ù†</th>
              <th>ğŸ‘¤ ØµØ§Ø­Ø¨ Ø§Ù„Ø­Ø³Ø§Ø¨</th>
              <th>ğŸ§‘ Ø§Ù„ÙˆØ³ÙŠØ·</th>
              <th>ğŸ”™ Ø§Ù„ØªØ±Ø§Ø¬Ø¹</th>
            </tr>
          </thead>
          <tbody>
            {% for request in approved_withdrawals[:12] %}
            <tr>
              <td>{{ request.created_at.strftime('%Y-%m-%d') }}</td>
              <td>{{ request.amount }} Ø±ÙŠØ§Ù„</td>
              <td>{{ request.bank_name }}</td>
              <td>{{ request.account_number }}</td>
              <td>{{ request.iban_number }}</td>
              <td>{{ request.account_holder }}</td>
              <td>{{ request.intermediary.username }}</td>
              <td>
                <a href="{{ url_for('main_routes.revert_withdrawal', withdrawal_id=request.id) }}" class="btn btn-warning btn-sm rounded-pill shadow-sm">
                  ğŸ”„ ØªØ±Ø§Ø¬Ø¹
                </a>
              </td>
            </tr>
            {% else %}
            <tr>
              <td colspan="8" class="text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø³Ø­Ø¨ Ù…Ù‚Ø¨ÙˆÙ„Ø©.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>

        <hr>

        <!-- Ø¬. Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ù…Ø±ÙÙˆØ¶Ø© -->
        <h5 class="text-danger"><i class="bi bi-x-circle"></i> Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ù…Ø±ÙÙˆØ¶Ø©</h5>
        <table class="table table-hover align-middle">
          <thead>
            <tr>
              <th>ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨</th>
              <th>ğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº</th>
              <th>ğŸ¦ Ø§Ù„Ø¨Ù†Ùƒ</th>
              <th>ğŸ’³ Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨</th>
              <th>ğŸ”¢ Ø§Ù„Ø¢ÙŠØ¨Ø§Ù†</th>
              <th>ğŸ‘¤ ØµØ§Ø­Ø¨ Ø§Ù„Ø­Ø³Ø§Ø¨</th>
              <th>ğŸ§‘ Ø§Ù„ÙˆØ³ÙŠØ·</th>
              <th>ğŸ”™ Ø§Ù„ØªØ±Ø§Ø¬Ø¹</th>
            </tr>
          </thead>
          <tbody>
            {% for request in rejected_withdrawals[:12] %}
            <tr>
              <td>{{ request.created_at.strftime('%Y-%m-%d') }}</td>
              <td>{{ request.amount }} Ø±ÙŠØ§Ù„</td>
              <td>{{ request.bank_name }}</td>
              <td>{{ request.account_number }}</td>
              <td>{{ request.iban_number }}</td>
              <td>{{ request.account_holder }}</td>
              <td>{{ request.intermediary.username }}</td>
              <td>
                <a href="{{ url_for('main_routes.revert_withdrawal', withdrawal_id=request.id) }}" class="btn btn-warning btn-sm rounded-pill shadow-sm">
                  ğŸ”„ ØªØ±Ø§Ø¬Ø¹
                </a>
              </td>
            </tr>
            {% else %}
            <tr>
              <td colspan="8" class="text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø³Ø­Ø¨ Ù…Ø±ÙÙˆØ¶Ø©.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>

      </div>
    </div>
  </div>

  <!-- 11. Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙˆØ³Ø·Ø§Ø¡ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ† -->
  <div id="intermediariesSection" class="dashboard-section" style="display:none;">
    <div class="card shadow mb-4">
      <div class="card-header bg-dark text-white">
        <h4 class="mb-0"><i class="bi bi-people"></i> Ø§Ù„ÙˆØ³Ø·Ø§Ø¡ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†</h4>
      </div>
      <div class="card-body table-responsive">
        <table class="table table-hover align-middle">
          <thead>
            <tr>
              <th>ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…</th>
              <th>ğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th>
              <th>ğŸ“ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</th>
              <th>ğŸ”´ Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø³Ø§Ø¨</th>
              <th>ğŸ“„ Ø§Ù„ØªÙØ§ØµÙŠÙ„</th>
              <th>âš™ï¸ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
            </tr>
          </thead>
          <tbody>
            {% for intermediary in intermediaries %}
            <tr>
              <td>
                <a href="{{ url_for('main_routes.intermediary_details', intermediary_id=intermediary.id) }}" class="text-decoration-none">
                  <i class="bi bi-person-circle"></i> {{ intermediary.username }}
                </a>
              </td>
              <td>{{ intermediary.email }}</td>
              <td>{{ intermediary.phone or "ØºÙŠØ± Ù…ØªÙˆÙØ±" }}</td>
              <td>
                {% if intermediary.status == "active" %}
                  <span class="badge bg-success">âœ… Ù†Ø´Ø·</span>
                {% elif intermediary.status == "suspended" %}
                  <span class="badge bg-danger">â›” Ù…ÙˆÙ‚ÙˆÙ</span>
                {% else %}
                  <span class="badge bg-warning">â³ ØªØ­Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</span>
                {% endif %}
              </td>
              <td>
                <a href="{{ url_for('main_routes.intermediary_details', intermediary_id=intermediary.id) }}" class="btn btn-sm btn-info rounded-pill shadow-sm">
                  <i class="bi bi-eye"></i> Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
                </a>
              </td>
              <td>
                <form method="POST" action="{{ url_for('main_routes.update_user_status', user_id=intermediary.id) }}">
                  <select class="form-select form-select-sm d-inline-block w-auto" name="new_status">
                    <option value="active" {% if intermediary.status == "active" %}selected{% endif %}>âœ… Ù†Ø´Ø·</option>
                    <option value="suspended" {% if intermediary.status == "suspended" %}selected{% endif %}>â›” Ù…ÙˆÙ‚ÙˆÙ</option>
                    <option value="under_review" {% if intermediary.status == "under_review" %}selected{% endif %}>â³ ØªØ­Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</option>
                  </select>
                  <button type="submit" class="btn btn-sm btn-primary rounded-pill shadow-sm">
                    <i class="bi bi-save"></i> ØªØ­Ø¯ÙŠØ«
                  </button>
                </form>
              </td>
            </tr>
            {% else %}
            <tr>
              <td colspan="6" class="text-center">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØ³Ø·Ø§Ø¡ Ù…Ø³Ø¬Ù„ÙŠÙ†.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

</div>

<!-- Ø¬Ø§ÙØ§ Ø³ÙƒØ±ÙŠØ¨Øª Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¹Ø±Ø¶ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const tabs = document.querySelectorAll('#dashboardTabs a');
  const sections = document.querySelectorAll('.dashboard-section');
  
  tabs.forEach(function(tab) {
    tab.addEventListener('click', function(e) {
      e.preventDefault();
      // Ø¥Ø²Ø§Ù„Ø© ØªÙØ¹ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª ÙˆØ¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
      tabs.forEach(t => t.classList.remove('active'));
      sections.forEach(section => section.style.display = 'none');
      // ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø®ØªØ§Ø± ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚
      tab.classList.add('active');
      const targetId = tab.getAttribute('data-target');
      const targetSection = document.getElementById(targetId);
      if (targetSection) {
        targetSection.style.display = 'block';
      }
    });
  });
});
</script>

<script>
  document.getElementById("myForm").addEventListener("submit", function(e) {
    e.preventDefault(); // Ù…Ù†Ø¹ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    let formData = new FormData(this);
    fetch(this.action, {
      method: 'POST',
      body: formData
    })
    .then(response => response.json())
    .then(data => {
      // ØªØ­Ø¯ÙŠØ« Ø¹Ù†Ø§ØµØ± Ø§Ù„ØµÙØ­Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©
      console.log(data);
    })
    .catch(error => console.error('Error:', error));
  });
</script>
  
{% endblock %}
