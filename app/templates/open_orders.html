{% extends "base.html" %}

{% block title %}ğŸ“Œ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙØªÙˆØ­Ø© - Ø¬Ù…Ù„Ø©{% endblock %}

{% block content %}
<h2 class="mb-4">ğŸ“Œ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙØªÙˆØ­Ø©</h2>

<!-- ğŸ” ØªØµÙÙŠØ© Ø§Ù„Ø·Ù„Ø¨Ø§Øª -->
<div class="mb-3 d-flex justify-content-between">
  <form method="GET" class="d-flex">
    <select class="form-select me-2" style="width: 200px;" name="filter" onchange="this.form.submit()">
      <option>ğŸ” Ø§Ù„Ø£ÙƒØ«Ø± Ø´Ø¹Ø¨ÙŠØ©</option>
      <option>ğŸš€ Ø§Ù„Ø£Ù‚Ø±Ø¨ Ù„Ù„Ø§ÙƒØªÙ…Ø§Ù„</option>
      <option>ğŸ†• Ø§Ù„Ø£Ø­Ø¯Ø«</option>
    </select>
  </form>
</div>

<!-- ğŸ·ï¸ Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª -->
<div class="row">
  {% for order_data in orders %}
  {% set order = order_data.order %}
  {% set approved_quantity = order_data.quantity_covered %}
  <div class="col-md-4 mb-4">
    <div class="card shadow-sm border-0">
      <!-- ğŸ–¼ï¸ ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬ -->
      <img src="{{ order.image_url }}" class="img-fluid rounded" alt="ØµÙˆØ±Ø© Ø§Ù„Ø·Ù„Ø¨ÙŠØ©">
      <div class="card-body">
        <!-- ğŸ“Œ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø·Ù„Ø¨ÙŠØ© -->
        <h5 class="card-title">{{ order.name }}</h5>
        <!-- ğŸ“ ÙˆØµÙ Ø§Ù„Ø·Ù„Ø¨ÙŠØ© -->
        <p class="card-text text-muted">{{ order.description }}</p>

        <!-- ğŸ“Š Ù†Ø³Ø¨Ø© Ø§Ù„Ø§ÙƒØªÙ…Ø§Ù„ -->
        <div class="progress mb-2">
          <div 
            class="progress-bar bg-success" 
            role="progressbar" 
            style="width: {{ (approved_quantity / order.quantity_needed) * 100 if order.quantity_needed > 0 else 0 }}%;" 
            aria-valuenow="{{ approved_quantity }}" 
            aria-valuemin="0" 
            aria-valuemax="{{ order.quantity_needed }}">
            {{ (approved_quantity / order.quantity_needed) * 100 if order.quantity_needed > 0 else 0 | round(1) }}%
          </div>
        </div>

        <!-- ğŸ† Ù…ÙƒØ³Ø¨ Ø§Ù„ÙˆØ³ÙŠØ· -->
        {% if order.intermediary_status == "open" %}
        <p class="text-success fw-bold">
          ğŸ’° Ù…ÙƒØ³Ø¨ Ø§Ù„ÙˆØ³ÙŠØ· Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:
          <span class="text-dark"> {{ 20 * order.min_contribution * order.earnings_per_carton }} Ø±ÙŠØ§Ù„ </span> 
          Ø¹Ù†Ø¯ Ø¥ØªÙ…Ø§Ù… 20 Ø¹Ù…ÙŠÙ„!
        </p>
        {% else %}
        <p class="text-danger fw-bold"> ğŸš« Ù„Ø§ ÙŠØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ ÙˆØ³ÙŠØ· </p>
        {% endif %}

        <!-- ğŸ”¢ Ø§Ù„ÙƒÙ…ÙŠØ§Øª -->
        <p class="text-secondary">
          ğŸ“¦ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: <b>{{ order.quantity_needed }}</b> | âœ… Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©: <b>{{ approved_quantity }}</b> | â³ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: <b>{{ order.quantity_needed - approved_quantity }}</b>
        </p>

        <!-- ğŸ·ï¸ Ø²Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© -->
        <a href="{{ url_for('main_routes.order_details', order_id=order.id) }}" class="btn btn-primary w-100">
          ğŸš€ Ø´Ø§Ø±Ùƒ Ø§Ù„Ø¢Ù†
        </a>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

{% endblock %}
