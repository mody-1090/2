{% extends "base.html" %}
{% block title %}Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„ÙˆØ³ÙŠØ·{% endblock %}

{% block content %}
<div class="container-fluid p-4">
  <!-- Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø© -->
  <div class="row mb-4">
    <div class="col text-center">
      <h2 class="display-5">ğŸ¯ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„ÙˆØ³ÙŠØ· - {{ user.username }}</h2>
    </div>
  </div>

  <div class="row">
    <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ Ù„Ù„ØªÙ†Ù‚Ù„ -->
    <div class="col-md-3 mb-4">
      <div class="list-group shadow">
        <!-- Ø¥Ø¹Ø§Ø¯Ø© ØªØ±ØªÙŠØ¨ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© -->
        <a href="#homeSection" class="list-group-item list-group-item-action active">
          <i class="bi bi-speedometer2"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        </a>
        <a href="#ordersTable" class="list-group-item list-group-item-action">
          <i class="bi bi-card-list"></i> Ø§Ù„Ø·Ù„Ø¨Ø§Øª
        </a>
        <a href="#addOrder" class="list-group-item list-group-item-action">
          <i class="bi bi-plus-circle"></i> Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø¨
        </a>
        
      </div>

      
    </div>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <div class="col-md-9">
      <!-- 1. Ù‚Ø³Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
      <div class="section" id="homeSection">


<<!-- ğŸ”” Ù‚Ø³Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->
<h3>ğŸ”” Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h3>
<div class="card shadow mb-4">
  <div class="card-header bg-warning text-dark d-flex justify-content-between align-items-center">
    <h4 class="mb-0"><i class="bi bi-bell"></i> Ø¥Ø´Ø¹Ø§Ø±Ø§ØªÙƒ</h4>
    <span class="text-muted">ğŸ“Œ Ø£Ø­Ø¯Ø« 5 Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</span>
  </div>
  <div class="card-body table-responsive">
    <table class="table table-hover">
      <thead>
        <tr>
          <th>ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
          <th>ğŸ“¢ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±</th>
        </tr>
      </thead>
      <tbody>
        {% set notifications = user.notifications | sort(attribute='created_at', reverse=True) %}
        {% for notification in notifications[:5] %}
        <tr>
          <td>{{ notification.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
          <td>{{ notification.message }}</td>
        </tr>
        {% endfor %}
        {% if notifications | length == 0 %}
        <tr>
          <td colspan="2" class="text-center">ğŸš€ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©.</td>
        </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</div>

<table class="table">
  <thead>
      <tr>
          <th>#</th>
          <th>Ø§Ø³Ù… Ø§Ù„Ø·Ù„Ø¨</th>
          <th>Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</th>
          <th>Ù…Ù„Ù Ø§Ù„Ø·Ù„Ø¨ÙŠØ©</th>
      </tr>
  </thead>
  <tbody>
    {% for order, participant in participant_orders %}
        {% if participant.cartons_requested == 0 %}
        <tr>
            <td>{{ loop.index }}</td>
            <td>{{ order.name }}</td>
            <td>{{ participant.status }}</td>
            <td>
                {% if order.zip_file_path %}
                    <a href="{{ order.zip_file_path }}" class="btn btn-primary btn-sm" target="_blank">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù</a>
                {% else %}
                    <span class="text-muted">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„Ù</span>
                {% endif %}
            </td>
        </tr>
        {% endif %}
    {% endfor %}
</tbody>

</table>

        
        <h3>ğŸ’° Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</h3>
        <div class="row">
          <!-- Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ù…Ø­Ù‚Ù‚Ø© -->
          <div class="col-md-4">
            <div class="card text-white bg-success mb-3">
              <div class="card-header">ğŸ’° Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ù…Ø­Ù‚Ù‚Ø©</div>
              <div class="card-body">
                <h5 class="card-title">{{ total_earnings }} Ø±ÙŠØ§Ù„</h5>
                <p class="card-text">Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¨Ù„Øº Ù…ØªØ§Ø­ Ù„Ù„Ø³Ø­Ø¨.</p>
              </div>
            </div>
          </div>
          <!-- Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© -->
          <div class="col-md-4">
            <div class="card text-white bg-warning mb-3">
              <div class="card-header">â³ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</div>
              <div class="card-body">
                <h5 class="card-title">{{ pending_earnings }} Ø±ÙŠØ§Ù„</h5>
                <p class="card-text">Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¨Ù„Øº Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ù‚Ø¨Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„.</p>
              </div>
            </div>
          </div>
          <!-- Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ù…Ø³Ø­ÙˆØ¨Ø© -->
          <div class="col-md-4">
            <div class="card text-white bg-info mb-3">
              <div class="card-header">âœ… Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ù…Ø³Ø­ÙˆØ¨Ø©</div>
              <div class="card-body">
                <h5 class="card-title">{{ withdrawn_earnings }} Ø±ÙŠØ§Ù„</h5>
                <p class="card-text">ØªÙ… ØªØ­ÙˆÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¨Ù„Øº Ø¥Ù„ÙŠÙƒ.</p>
              </div>
            </div>
          </div>
        </div>

        <h3>ğŸ’° Ù…ØªØ§Ø¨Ø¹Ø© Ø­Ø§Ù„Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨</h3>
        <div class="card shadow mb-4">
          <div class="card-header bg-info text-white">
            <h4 class="mb-0"><i class="bi bi-clock-history"></i> Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨</h4>
          </div>
          <div class="card-body table-responsive">
            <table class="table table-hover align-middle">
              <thead>
                <tr>
                  <th>ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨</th>
                  <th>ğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº</th>
                  <th>ğŸ¦ Ø§Ù„Ø¨Ù†Ùƒ</th>
                  <th>ğŸ’³ Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨</th>
                  <th>ğŸ”¢ Ø§Ù„Ø¢ÙŠØ¨Ø§Ù†</th>
                  <th>âœ… Ø§Ù„Ø­Ø§Ù„Ø©</th>
                </tr>
              </thead>
              <tbody>
                {% for request in withdrawal_requests %}
                <tr>
                  <td>{{ request.created_at.strftime('%Y-%m-%d') }}</td>
                  <td>{{ request.amount }} Ø±ÙŠØ§Ù„</td>
                  <td>{{ request.bank_name }}</td>
                  <td>{{ request.account_number }}</td>
                  <td>{{ request.iban_number }}</td>
                  <td>
                    {% if request.status == "pending" %}
                      <span class="badge bg-warning">â³ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</span>
                    {% elif request.status == "approved" %}
                      <span class="badge bg-success">âœ… Ù…Ù‚Ø¨ÙˆÙ„</span>
                    {% else %}
                      <span class="badge bg-danger">âŒ Ù…Ø±ÙÙˆØ¶</span>
                    {% endif %}
                  </td>
                </tr>
                {% else %}
                <tr>
                  <td colspan="6" class="text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø³Ø­Ø¨ Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>

        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#withdrawModal">
          ğŸ’° Ø·Ù„Ø¨ Ø³Ø­Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­
        </button>

<!-- Ù†Ø§ÙØ°Ø© ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ Ø³Ø­Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ -->
<div class="modal fade" id="withdrawModal" tabindex="-1" aria-labelledby="withdrawModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="withdrawModalLabel">Ø·Ù„Ø¨ Ø³Ø­Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Ø¥ØºÙ„Ø§Ù‚"></button>
      </div>
      <div class="modal-body">
        <form method="POST" action="{{ url_for('main_routes.request_withdrawal') }}">
          {{ form.hidden_tag() }}
          <!-- ğŸ”¹ Ø§Ø³Ù… ØµØ§Ø­Ø¨ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ -->
          <div class="mb-3">
            <label class="form-label">ğŸ‘¤ Ø§Ø³Ù… ØµØ§Ø­Ø¨ Ø§Ù„Ø­Ø³Ø§Ø¨</label>
            {{ form.account_holder(class="form-control", placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… ØµØ§Ø­Ø¨ Ø§Ù„Ø­Ø³Ø§Ø¨") }}
          </div>

          <!-- ğŸ”¹ Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ -->
          <div class="mb-3">
            <label class="form-label">ğŸ¦ Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ</label>
            {{ form.bank_name(class="form-control", placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ") }}
          </div>

          <!-- ğŸ”¹ Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ -->
          <div class="mb-3">
            <label class="form-label">ğŸ’³ Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ</label>
            {{ form.account_number(class="form-control", placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨") }}
          </div>

          <!-- ğŸ”¹ Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ¨Ø§Ù† -->
          <div class="mb-3">
            <label class="form-label">ğŸ”¢ Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ¨Ø§Ù†</label>
            {{ form.iban_number(class="form-control", placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ¨Ø§Ù†") }}
          </div>

          <!-- ğŸ”¹ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ (Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„Ù‡ØŒ ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ù…Ø­Ù‚Ù‚Ø©) -->
          <div class="mb-3">
            <label class="form-label">ğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø³Ø­Ø¨Ù‡</label>
            <input type="number" class="form-control" name="amount" value="{{ total_earnings }}" readonly>
          </div>

          <!-- Ø²Ø± ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨ -->
          {{ form.submit(class="btn btn-success w-100") }}
        </form>
      </div>
    </div>
  </div>
</div>
      </div>
      <hr>

      <!-- 2. Ù‚Ø³Ù… Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø© -->
      <div class="section" id="ordersTable">
        <h3>ğŸ“‹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</h3>

        <!-- ğŸ”„ Ø²Ø± ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© -->
        <div class="text-end mb-3">
          <button class="btn btn-info" onclick="location.reload();">
            <i class="bi bi-arrow-clockwise"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©
          </button>
        </div>

        <!-- Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© -->
        <div class="card shadow mb-4">
          <div class="card-header bg-warning text-dark">
            <h4 class="mb-0"><i class="bi bi-hourglass-split"></i> Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</h4>
          </div>
          <div class="card-body table-responsive">
            {% set per_page = 5 %}
            {% set review_participants = managed_participants | selectattr("status", "equalto", "under_review") | selectattr("cartons_requested", "gt", 0) | list %}
            {% set total_review_pages = (review_participants|length // per_page) + (1 if review_participants|length % per_page > 0 else 0) %}
            <div id="review-pages">
              {% for page in range(total_review_pages) %}
                <div class="page review-page" id="review-page-{{ page }}" {% if page > 0 %}style="display: none;"{% endif %}>
                  <table class="table table-hover align-middle">
                    <thead>
                      <tr>
                        <th>ğŸ“¦ Ø§Ù„Ø·Ù„Ø¨ÙŠØ©</th>
                        <th>ğŸª Ø§Ù„Ù…ØªØ¬Ø±</th>
                        <th>ğŸ“¦ Ø¹Ø¯Ø¯ Ø§Ù„ÙƒØ±Ø§ØªÙŠÙ†</th>
                        <th>ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
                        <th>ğŸ‘¤ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</th>
                        <th>ğŸ“± Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</th>
                        <th>ğŸ”— Ø§Ù„ØªÙØ§ØµÙŠÙ„</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for participant in review_participants[page * per_page : (page + 1) * per_page] %}
                      <tr>
                        <td>{{ participant.order.name }}</td>
                        <td>{{ participant.store_name }}</td>
                        <td>{{ participant.cartons_requested }}</td>
                        <td>{{ participant.location }}</td>
                        <td>{{ participant.responsible_person }}</td>
                        <td>{{ participant.customer_phone }}</td>
                        <td>
                          <a href="{{ url_for('main_routes.customer_order_details', participant_id=participant.id) }}" class="btn btn-sm btn-primary">
                            <i class="bi bi-eye"></i> Ø¹Ø±Ø¶
                          </a>
                        </td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              {% endfor %}
            </div>
            <div class="text-center mt-3">
              {% if total_review_pages > 1 %}
                <button class="btn btn-warning btn-sm" onclick="changePage('review', -1)">â¬…ï¸ Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
                <span id="review-page-indicator">ØµÙØ­Ø© 1 Ù…Ù† {{ total_review_pages }}</span>
                <button class="btn btn-warning btn-sm" onclick="changePage('review', 1)">Ø§Ù„ØªØ§Ù„ÙŠ â¡ï¸</button>
              {% endif %}
            </div>
          </div>
        </div>

        <!-- Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„Ø© -->
        <div class="card shadow mb-4">
          <div class="card-header bg-success text-white">
            <h4 class="mb-0"><i class="bi bi-check-circle"></i> Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„Ø©</h4>
          </div>
          <div class="card-body table-responsive">
            {% set approved_participants = managed_participants | selectattr("status", "equalto", "approved") | selectattr("cartons_requested", "gt", 0) | list %}
            {% set total_approved_pages = (approved_participants|length // per_page) + (1 if approved_participants|length % per_page > 0 else 0) %}
            <div id="approved-pages">
              {% for page in range(total_approved_pages) %}
                <div class="page approved-page" id="approved-page-{{ page }}" {% if page > 0 %}style="display: none;"{% endif %}>
                  <table class="table table-hover align-middle">
                    <thead>
                      <tr>
                        <th>ğŸ“¦ Ø§Ù„Ø·Ù„Ø¨ÙŠØ©</th>
                        <th>ğŸª Ø§Ù„Ù…ØªØ¬Ø±</th>
                        <th>ğŸ“¦ Ø¹Ø¯Ø¯ Ø§Ù„ÙƒØ±Ø§ØªÙŠÙ†</th>
                        <th>ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
                        <th>ğŸ‘¤ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</th>
                        <th>ğŸ“± Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</th>
                        <th>ğŸ”— Ø§Ù„ØªÙØ§ØµÙŠÙ„</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for participant in approved_participants[page * per_page : (page + 1) * per_page] %}
                      <tr>
                        <td>{{ participant.order.name }}</td>
                        <td>{{ participant.store_name }}</td>
                        <td>{{ participant.cartons_requested }}</td>
                        <td>{{ participant.location }}</td>
                        <td>{{ participant.responsible_person }}</td>
                        <td>{{ participant.customer_phone }}</td>
                        <td>
                          <a href="{{ url_for('main_routes.customer_order_details', participant_id=participant.id) }}" class="btn btn-sm btn-primary">
                            <i class="bi bi-eye"></i> Ø¹Ø±Ø¶
                          </a>
                        </td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              {% endfor %}
            </div>
            <div class="text-center mt-3">
              {% if total_approved_pages > 1 %}
                <button class="btn btn-success btn-sm" onclick="changePage('approved', -1)">â¬…ï¸ Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
                <span id="approved-page-indicator">ØµÙØ­Ø© 1 Ù…Ù† {{ total_approved_pages }}</span>
                <button class="btn btn-success btn-sm" onclick="changePage('approved', 1)">Ø§Ù„ØªØ§Ù„ÙŠ â¡ï¸</button>
              {% endif %}
            </div>
          </div>
        </div>

        <!-- Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¶Ø© -->
        <div class="card shadow mb-4">
          <div class="card-header bg-danger text-white">
            <h4 class="mb-0"><i class="bi bi-x-circle"></i> Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¶Ø©</h4>
          </div>
          <div class="card-body table-responsive">
            {% set rejected_participants = managed_participants | selectattr("status", "equalto", "rejected") | list %}
            {% set total_rejected_pages = (rejected_participants|length // per_page) + (1 if rejected_participants|length % per_page > 0 else 0) %}
            <div id="rejected-pages">
              {% for page in range(total_rejected_pages) %}
                <div class="page rejected-page" id="rejected-page-{{ page }}" {% if page > 0 %}style="display: none;"{% endif %}>
                  <table class="table table-hover align-middle">
                    <thead>
                      <tr>
                        <th>ğŸ“¦ Ø§Ù„Ø·Ù„Ø¨ÙŠØ©</th>
                        <th>ğŸª Ø§Ù„Ù…ØªØ¬Ø±</th>
                        <th>ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
                        <th>ğŸ‘¤ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</th>
                        <th>ğŸ“± Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</th>
                        <th>ğŸ”— Ø§Ù„ØªÙØ§ØµÙŠÙ„</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for participant in rejected_participants[page * per_page : (page + 1) * per_page] %}
                      <tr>
                        <td>{{ participant.order.name }}</td>
                        <td>{{ participant.store_name }}</td>
                        <td>{{ participant.location }}</td>
                        <td>{{ participant.responsible_person }}</td>
                        <td>{{ participant.customer_phone }}</td>
                        <td>
                          <a href="{{ url_for('main_routes.customer_order_details', participant_id=participant.id) }}" class="btn btn-sm btn-primary">
                            <i class="bi bi-eye"></i> Ø¹Ø±Ø¶
                          </a>
                        </td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              {% endfor %}
            </div>
            <div class="text-center mt-3">
              {% if total_rejected_pages > 1 %}
                <button class="btn btn-danger btn-sm" onclick="changePage('rejected', -1)">â¬…ï¸ Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
                <span id="rejected-page-indicator">ØµÙØ­Ø© 1 Ù…Ù† {{ total_rejected_pages }}</span>
                <button class="btn btn-danger btn-sm" onclick="changePage('rejected', 1)">Ø§Ù„ØªØ§Ù„ÙŠ â¡ï¸</button>
              {% endif %}
            </div>
          </div>
        </div>
      </div>

      <hr>

      <!-- 3. Ù‚Ø³Ù… ØªØ³Ø¬ÙŠÙ„ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ -->
      <div class="section" id="addOrder">
        <!-- Ø®ÙŠØ§Ø±Ø§Øª Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ -->
        <div class="mb-3">
          <label class="form-label">Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„:</label>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="registration_mode" id="manualRegistration" value="manual" checked>
            <label class="form-check-label" for="manualRegistration">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙŠØ¯ÙˆÙŠ</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="registration_mode" id="selfRegistration" value="self">
            <label class="form-check-label" for="selfRegistration">Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙŠØ³Ø¬Ù„ Ù†ÙØ³Ù‡ Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ø§Ù„Ø±Ø§Ø¨Ø·</label>
          </div>
        </div>

        <!-- ØªØºÙ„ÙŠÙ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¯Ø§Ø®Ù„ Ù‚Ø³Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙŠØ¯ÙˆÙŠ -->
        <div id="manualRegistrationSection">
          <h3>â• ØªØ³Ø¬ÙŠÙ„ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h3>
          <div class="card mb-4 shadow">
            <div class="card-header bg-primary text-white">
              <h4 class="mb-0"><i class="bi bi-pencil-square"></i> ØªØ³Ø¬ÙŠÙ„ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h4>
            </div>
            <div class="card-body">
              <form method="POST" action="{{ url_for('main_routes.add_customer') }}" enctype="multipart/form-data">
                <!-- ğŸ”¹ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø·Ù„Ø¨ÙŠØ© -->
                <div class="mb-3">
                  <label class="form-label">ğŸ·ï¸ Ø§Ø®ØªØ± Ø§Ù„Ø·Ù„Ø¨ÙŠØ©</label>
                  <select class="form-select" name="order_id" id="order_id" required>
                    <option value="" selected disabled>-- Ø§Ø®ØªØ± Ø§Ù„Ø·Ù„Ø¨ÙŠØ© --</option>
                    {% for order in assigned_orders %}
                      <option value="{{ order.id }}" 
                              data-price="{{ order.price_per_carton }}" 
                              data-min="{{ order.min_contribution }}" 
                              data-bank-name="{{ order.factory_agreement.bank_name if order.factory_agreement else '' }}"
                              data-bank-account="{{ order.factory_agreement.bank_account_number if order.factory_agreement else '' }}"
                              data-iban="{{ order.factory_agreement.iban_number if order.factory_agreement else '' }}"
                              data-commercial-registration="{{ order.factory_agreement.commercial_registration if order.factory_agreement else '' }}">
                        {{ order.name }} (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰: {{ order.min_contribution }} ÙƒØ±ØªÙˆÙ†ØŒ Ø§Ù„Ø³Ø¹Ø±: {{ order.price_per_carton }} Ø±ÙŠØ§Ù„)
                      </option>
                    {% endfor %}
                  </select>
                </div>

                <!-- Ø¨Ø§Ù‚ÙŠ Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ ÙƒÙ…Ø§ Ù‡Ùˆ -->
                <div class="mb-3">
                  <label class="form-label">ğŸª Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø± Ø£Ùˆ Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
                  <input type="text" class="form-control" name="store_name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø± Ø£Ùˆ Ø§Ù„Ø¹Ù…ÙŠÙ„" required>
                </div>

                <div class="mb-3">
                  <label class="form-label">ğŸ“¦ Ø¹Ø¯Ø¯ Ø§Ù„ÙƒØ±Ø§ØªÙŠÙ† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</label>
                  <input type="number" class="form-control" name="cartons_requested" id="cartons_requested" min="1" required>
                  <small class="text-muted">ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ø¹Ø¯Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨.</small>
                </div>

                <div class="mb-3">
                  <label class="form-label">ğŸ“ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
                  <input type="text" class="form-control" name="location" placeholder="Ø£Ø¯Ø®Ù„ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ù…ÙŠÙ„" required>
                </div>

                <div class="mb-3">
                  <label class="form-label">ğŸ‘¤ Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</label>
                  <input type="text" class="form-control" name="responsible_person" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„" required>
                </div>

                <div class="mb-3">
                  <label class="form-label">ğŸ“± Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„ Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
                  <input type="text" class="form-control" name="customer_phone" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„ Ø§Ù„Ø¹Ù…ÙŠÙ„" required>
                </div>

                <div class="mb-3">
                  <label class="form-label">ğŸ”¢ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ</label>
                  <input type="text" class="form-control" name="tax_number" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ" required>
                </div>

                <div class="mb-3">
                  <label class="form-label">ğŸ“œ ØµÙˆØ±Ø© Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ</label>
                  <input type="file" class="form-control" name="commercial_record" required>
                </div>

                <div class="mb-3">
                  <label class="form-label">ğŸª ØµÙˆØ±Ø© Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø­Ù„</label>
                  <input type="file" class="form-control" name="store_sign" required>
                </div>

                <!-- ğŸ”¹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ -->
                <div class="card mb-3 p-3 border">
                  <h5>ğŸ¦ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ</h5>
                  <p>Ø¹Ù†Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ØŒ ÙŠØ¬Ø¨ Ø¹Ù„ÙŠÙƒ Ø§Ù„Ø¯ÙØ¹ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙˆØ±Ø¯.</p>
                  <p><strong>ğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:</strong> <span id="payment_amount">0</span> Ø±ÙŠØ§Ù„</p>
                  <p><strong>ğŸ¦ Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ:</strong> <span id="bank_name">Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ / Ø´Ø±ÙƒØ© Ù…Ø­Ù…Ø¯ Ø­Ø³Ù† Ù…Ø­Ù…Ø¯ Ø§Ù„Ø­Ø±Ø¨ÙŠ Ù„ØªØ¬Ø§Ø±Ø© Ø§Ù„Ø¬Ù…Ù„Ø© ÙˆØ§Ù„ØªØ¬Ø²Ø¦Ø©</span></p>
                  <p><strong>ğŸ’³ Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨:</strong> <span id="bank_account">--</span></p>
                  <p><strong>ğŸ”¢ Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ¨Ø§Ù†:</strong> <span id="iban_number">SA9480000589608016204363</span></p>
                  <p><strong>ğŸ“œ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ:</strong> <span id="commercial_registration">--</span></p>
                </div>

                <!-- ğŸ”¹ Ø±ÙØ¹ Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ø¯ÙØ¹ -->
                <div class="mb-3">
                  <label class="form-label">ğŸ“¤ Ø±ÙØ¹ Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ø¯ÙØ¹</label>
                  <input type="file" class="form-control" name="payment_receipt" required>
                </div>

                <div class="d-flex justify-content-end gap-2">
                  <button type="reset" class="btn btn-secondary">
                    <i class="bi bi-arrow-counterclockwise"></i> Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
                  </button>
                  <button type="submit" class="btn btn-success">
                    <i class="bi bi-check-circle"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <!-- Ù‚Ø³Ù… Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø°Ø§ØªÙŠ -->
        <div id="selfRegistrationSection" style="display: none;">
          <h3>ğŸ“Œ Ø±ÙˆØ§Ø¨Ø· ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù„ÙƒÙ„ Ø·Ù„Ø¨ÙŠØ©</h3>
          <table class="table table-bordered">
            <thead>
              <tr>
                <th>ğŸ“¦ Ø§Ø³Ù… Ø§Ù„Ø·Ù„Ø¨ÙŠØ©</th>
                <th>ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th>
              </tr>
            </thead>
            <tbody>
              {% for order in assigned_orders %}
              <tr>
                <td>{{ order.name }}</td>
                <td>
                  <input type="text" class="form-control" value="{{ url_for('main_routes.customer_registration', intermediary_id=user.id, order_id=order.id, _external=True) }}" readonly>
                  <button class="btn btn-sm btn-primary mt-2" onclick="copyToClipboard(this)">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·</button>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

      <!-- Ù†ÙˆØ§ÙØ° ÙˆÙ†ØµÙˆØµ Ø§Ù„Ø¬Ø§ÙØ§ Ø³ÙƒØ±ÙŠØ¨Øª ØªØ¨Ù‚Ù‰ Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± -->
      <script>
      // Ø¯Ø§Ù„Ø© Ø§Ù„Ù†Ø³Ø®
      function copyToClipboard(button) {
          var input = button.previousElementSibling;
          input.select();
          input.setSelectionRange(0, 99999);
          document.execCommand("copy");
          button.innerText = "âœ… ØªÙ… Ø§Ù„Ù†Ø³Ø®";
          setTimeout(() => {
              button.innerText = "ğŸ“‹ Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·";
          }, 2000);
      }

      // Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ÙŠØªÙ… Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
      document.addEventListener("DOMContentLoaded", function() {
          const sections = document.querySelectorAll(".section");
          function showSection(sectionId) {
              sections.forEach(section => {
                  section.style.display = section.id === sectionId ? "block" : "none";
              });
          }

          // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù‡Ø§Ø´ ÙÙŠ URL ÙˆØ¥Ø¸Ù‡Ø§Ø±Ù‡ØŒ ÙˆØ¥Ø°Ø§ Ù„Ù… ÙŠÙˆØ¬Ø¯ ÙŠØªÙ… Ø¥Ø¸Ù‡Ø§Ø± "homeSection"
          let hash = window.location.hash.substring(1);
          if (hash && document.getElementById(hash)) {
              showSection(hash);
          } else {
              showSection("homeSection");
          }

          // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ù„ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
          const navLinks = document.querySelectorAll(".list-group-item[href^='#']");
          navLinks.forEach(link => {
              link.addEventListener("click", function(e) {
                  e.preventDefault();
                  const targetId = this.getAttribute("href").substring(1);
                  showSection(targetId);
                  history.pushState(null, "", "#" + targetId);
                  navLinks.forEach(nav => nav.classList.remove("active"));
                  this.classList.add("active");
              });
          });
      });
      </script>

      <script>
      document.getElementById("order_id").addEventListener("change", function() {
          let selectedOption = this.options[this.selectedIndex];
          let pricePerCarton = parseFloat(selectedOption.getAttribute("data-price"));
          let minContribution = parseInt(selectedOption.getAttribute("data-min"));

          let cartonsInput = document.getElementById("cartons_requested");
          cartonsInput.setAttribute("min", minContribution);
          cartonsInput.value = minContribution;

          let totalAmount = pricePerCarton * minContribution;
          document.getElementById("payment_amount").textContent = totalAmount.toFixed(2);

          let bankName = selectedOption.getAttribute("data-bank-name") || "--";
          let bankAccount = selectedOption.getAttribute("data-bank-account") || "--";
          let ibanNumber = selectedOption.getAttribute("data-iban") || "--";
          let commercialRegistration = selectedOption.getAttribute("data-commercial-registration") || "--";

          document.getElementById("bank_name").textContent = bankName;
          document.getElementById("bank_account").textContent = bankAccount;
          document.getElementById("iban_number").textContent = ibanNumber;
          document.getElementById("commercial_registration").textContent = commercialRegistration;
      });

      document.getElementById("cartons_requested").addEventListener("input", function() {
          let selectedOption = document.getElementById("order_id").options[document.getElementById("order_id").selectedIndex];
          let pricePerCarton = parseFloat(selectedOption.getAttribute("data-price"));

          let cartonsRequested = parseInt(this.value);
          if (isNaN(cartonsRequested) || cartonsRequested < parseInt(selectedOption.getAttribute("data-min"))) {
              cartonsRequested = parseInt(selectedOption.getAttribute("data-min"));
              this.value = cartonsRequested;
          }

          let totalAmount = pricePerCarton * cartonsRequested;
          document.getElementById("payment_amount").textContent = totalAmount.toFixed(2);
      });
      </script>
      <script>
        document.querySelectorAll('input[name="registration_mode"]').forEach((elem) => {
          elem.addEventListener("change", function() {
            if(this.value === "manual") {
              document.getElementById("manualRegistrationSection").style.display = "block";
              document.getElementById("selfRegistrationSection").style.display = "none";
            } else if(this.value === "self") {
              document.getElementById("manualRegistrationSection").style.display = "none";
              document.getElementById("selfRegistrationSection").style.display = "block";
            }
          });
        });
      </script>
      <script>
        function changePage(section, direction) {
          let currentPageElement = document.getElementById(`${section}-page-indicator`);
          let currentPage = parseInt(currentPageElement.textContent.split(" ")[1]);
          let totalPages = parseInt(currentPageElement.textContent.split(" ")[3]);
        
          let newPage = currentPage + direction;
          if (newPage < 1 || newPage > totalPages) return;
        
          document.getElementById(`${section}-page-${currentPage - 1}`).style.display = "none";
          document.getElementById(`${section}-page-${newPage - 1}`).style.display = "block";
          currentPageElement.textContent = `ØµÙØ­Ø© ${newPage} Ù…Ù† ${totalPages}`;
        }
      </script>
      




      <script>
        document.getElementById("myForm").addEventListener("submit", function(e) {
          e.preventDefault(); // Ù…Ù†Ø¹ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
          let formData = new FormData(this);
          fetch(this.action, {
            method: 'POST',
            body: formData
          })
          .then(response => response.json())
          .then(data => {
            // ØªØ­Ø¯ÙŠØ« Ø¹Ù†Ø§ØµØ± Ø§Ù„ØµÙØ­Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©
            console.log(data);
          })
          .catch(error => console.error('Error:', error));
        });
        </script>
        
        
    </div>
  </div>
</div>
{% endblock %}
